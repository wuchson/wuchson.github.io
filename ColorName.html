<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>é¡è‰²åç¨±åˆ¤å®šå™¨</title>
    <style>
        :root { --ink: #1a1a1c; --gold: #b3935d; --soft-bg: #f9f9fb; }
        body { background: var(--soft-bg); font-family: "PingFang TC", "Microsoft JhengHei", sans-serif; margin: 0; display: flex; flex-direction: column; align-items: center; color: var(--ink); }
        .cam-view { width: 100%; max-width: 450px; aspect-ratio: 1; position: relative; background: #000; box-shadow: 0 4px 20px rgba(0,0,0,0.2); }
        #v { width: 100%; height: 100%; object-fit: cover; }
        .aimer { position: absolute; top: 50%; left: 50%; transform: translate(-50%, -50%); width: 24px; height: 24px; border: 2px solid #fff; border-radius: 50%; mix-blend-mode: difference; z-index: 10; }
        
        .card { width: 94%; max-width: 450px; background: white; border-radius: 30px; padding: 25px; margin-top: -40px; box-shadow: 0 20px 50px rgba(0,0,0,0.1); z-index: 20; box-sizing: border-box; }
        .swatch-box { display: flex; align-items: center; gap: 20px; margin-bottom: 20px; }
        #preview { width: 90px; height: 90px; border-radius: 20px; box-shadow: inset 0 0 0 1px rgba(0,0,0,0.05); }
        
        .name-stack { flex: 1; }
        .lv-tag { font-size: 10px; color: var(--gold); letter-spacing: 2px; font-weight: bold; }
        .lv-val { font-size: 22px; font-weight: 700; margin-bottom: 5px; color: var(--ink); }
        .lv-sub { font-size: 14px; color: #888; border-left: 2px solid #eee; padding-left: 8px; margin-top: 5px; }

        .controls { margin-top: 25px; background: #fdfdfd; padding: 15px; border-radius: 15px; }
        .s-row { margin-bottom: 12px; }
        .s-head { display: flex; justify-content: space-between; font-size: 11px; color: #999; margin-bottom: 4px; }
        input[type=range] { width: 100%; height: 4px; appearance: none; background: #eee; border-radius: 2px; outline: none; }
        input[type=range]::-webkit-slider-thumb { appearance: none; width: 20px; height: 20px; background: white; border: 1px solid #ddd; border-radius: 50%; box-shadow: 0 2px 5px rgba(0,0,0,0.1); }

        .btn-row { display: flex; gap: 10px; width: 94%; max-width: 450px; margin: 20px 0; }
        button { flex: 1; padding: 16px; border-radius: 15px; border: none; font-weight: bold; cursor: pointer; transition: 0.2s; font-size: 15px; }
        .btn-main { background: var(--ink); color: white; }
        .btn-mo { background: #efebe9; color: #5d4037; }
    </style>
</head>
<body>

<div class="cam-view">
    <video id="v" autoplay playsinline></video>
    <div class="aimer"></div>
</div>

<div class="btn-row">
    <button class="btn-main" onclick="detect()">ğŸ“¸ æ“·å–ä¸¦è¾¨è­˜</button>
    <button class="btn-mo" id="mo-btn" onclick="toggleMorandi()">âœ¨ è«è˜­è¿ªåŒ–</button>
</div>

<div class="card" id="res" style="display:none;">
    <div class="swatch-box">
        <div id="preview"></div>
        <div class="name-stack">
            <div class="lv-tag">å°ˆæ¥­å‘½å</div>
            <div class="lv-val" id="lv3">-</div>
            <div id="hex" style="font-family: monospace; font-size: 14px; color: #ccc;">#FFFFFF</div>
        </div>
    </div>
    
    <div class="lv-sub" id="lv2">-</div>
    <div class="lv-sub" id="lv1" style="border:none; font-size:12px; color:#bbb;">-</div>

    <div class="controls">
        <div class="s-row">
            <div class="s-head"><span>æ˜åº¦ (Lightness)</span><span id="lv">50%</span></div>
            <input type="range" id="ls" min="0" max="100" oninput="ui()">
        </div>
        <div class="s-row">
            <div class="s-head"><span>é£½å’Œåº¦ (Saturation)</span><span id="sv">50%</span></div>
            <input type="range" id="ss" min="0" max="100" oninput="ui()">
        </div>
    </div>
</div>

<canvas id="c" style="display:none;"></canvas>

<script>
let cH=0, cS=50, cL=50, backupS=50;
const v=document.getElementById('v'), c=document.getElementById('c'), ctx=c.getContext('2d');
navigator.mediaDevices.getUserMedia({video:{facingMode:"environment"}}).then(s=>v.srcObject=s);

function detect() {
    c.width=v.videoWidth; c.height=v.videoHeight;
    ctx.drawImage(v,0,0);
    const p=ctx.getImageData(c.width/2,c.height/2,1,1).data;
    const hsl=rgbToHsl(p[0],p[1],p[2]);
    cH=hsl[0]*360; cS=hsl[1]*100; cL=hsl[2]*100; backupS=cS;
    document.getElementById('ls').value=cL; document.getElementById('ss').value=cS;
    document.getElementById('mo-btn').innerText = "âœ¨ è«è˜­è¿ªåŒ–";
    ui();
}

function toggleMorandi() {
    const b = document.getElementById('mo-btn');
    if (cS > 30) { backupS=cS; cS=25; b.innerText="âª é‚„åŸåŸå§‹è‰²"; }
    else { cS=backupS; b.innerText="âœ¨ è«è˜­è¿ªåŒ–"; }
    document.getElementById('ss').value=cS; ui();
}

function ui() {
    cL=parseInt(document.getElementById('ls').value);
    cS=parseInt(document.getElementById('ss').value);
    const hex=hslToHex(cH,cS,cL);
    document.getElementById('res').style.display='block';
    document.getElementById('preview').style.backgroundColor=hex;
    document.getElementById('hex').innerText=hex;
    document.getElementById('lv').innerText=cL+"%";
    document.getElementById('sv').innerText=cS+"%";
    const n = getNames(cH, cS, cL);
    document.getElementById('lv1').innerText=n.v1;
    document.getElementById('lv2').innerText=n.v2;
    document.getElementById('lv3').innerText=n.v3;
}

function getNames(h,s,l) {
    // 1. é‡‘å±¬è‰²èˆ‡ç„¡å½©è‰² (ç™½ã€ç°ã€é»‘ã€é‡‘ã€éŠ€)
    if (l > 93) return {v1:"ç™½è‰²ç³»", v2:"ç´”ç™½è‰²", v3:"çµ²çµ¨é›ªç´¡ç™½"};
    if (l < 10) return {v1:"é»‘è‰²ç³»", v2:"æ¥µé»‘è‰²", v3:"é»‘æ›œçŸ³çŸ³å¢¨"};
    if (s < 12) {
        if (h > 35 && h < 90 && l > 50) return {v1:"éŠ€/é‡‘å±¬", v2:"é¦™æª³éŠ€", v3:"å†·éœ§é¦™æª³é‡‘"};
        if (l > 75) return {v1:"ç°è‰²ç³»", v2:"æ·ºç°è‰²", v3:"æ™¨éœ§ç¾Šçµ¨ç°"};
        if (l < 40) return {v1:"ç°è‰²ç³»", v2:"æ·±ç°è‰²", v3:"æ¿å²©æ²‰ç©©ç°"};
        return {v1:"ç°è‰²ç³»", v2:"ä¸­ç°è‰²", v3:"è«è˜­è¿ªç°"};
    }

    // 2. è†šè‰²èˆ‡è£¸è‰²ç³» (é«˜åº¦ç´°åˆ†)
    if (h >= 10 && h <= 45 && s < 45 && l > 45) {
        if (l > 85) return {v1:"è£¸è‰²ç³»", v2:"ç±³è‰²", v3:"å†·èª¿è£¸ç´—"};
        if (l > 75) return {v1:"è£¸è‰²ç³»", v2:"ç²‰è†šè‰²", v3:"èœœç²‰ææ¡ƒ"};
        if (l > 60) return {v1:"è£¸è‰²ç³»", v2:"è‡ªç„¶è†š", v3:"æº«æ½¤å¥¶èŒ¶"};
        return {v1:"è£¸è‰²ç³»", v2:"è£¸æ£•è‰²", v3:"æ³•å¼å¯å¯"};
    }

    // 3. å…¨è‰²ç›¸ç´°åˆ†
    const lib = [
        { r:[0, 15],   n:["ç´…","ç·‹ç´…","å‹ƒè‰®ç¬¬ç´…","å¾®é†ºç«ç‘°","å¤•é™½çŠç‘š"] },
        { r:[15, 35],  n:["æ©™","ç¥ç€","ç„¦ç³–ç‘ªå¥‡æœµ","æš–é™½æ©™","è‚‰æ¡‚æ£•"] },
        { r:[35, 55],  n:["æ£•","è¤è‰²","èƒ¡æ¡ƒæœ¨æ£•","æ‘©å¡å¡å…¶","ç…™è‰æ£•"] },
        { r:[55, 68],  n:["é»ƒ","é‡‘é»ƒ","å¥¶æ²¹å¡å£«é”","é¦™æª³é‡‘","å‘æ—¥è‘µ"] },
        { r:[68, 110], n:["å«©ç¶ ","èŠ½ç¶ ","è«å…§èŠ±åœ’ç¶ ","é’è˜‹æœ","åˆæ˜¥ç¶ "] },
        { r:[110, 160],n:["ç¶ ","æ£®ç¶ ","ç¿¡ç¿ çµ²çµ¨","æŠ¹èŒ¶è«è˜­è¿ª","å­”é›€ç¶ "] },
        { r:[160, 195],n:["é’","æ¹–ç¶ ","è’‚èŠ¬å¦®è—","é´¨è›‹é’","è–„è·è—"] },
        { r:[195, 235],n:["è—","è”šè—","åˆå¤œè—é’","è¿·éœ§æ·±è—","æ„›ç´æµ·"] },
        { r:[235, 265],n:["è—ç´«","é›è—","è–°è¡£è‰ç°","é³¶å°¾èŠ±","è¿·å¹»è—"] },
        { r:[265, 310],n:["ç´«","çµ³ç´«","è‘¡è„èŠåœ’","æ¥µè‡´æ·±ç´«","ä¸é¦™ç´«"] },
        { r:[310, 340],n:["ç«ç´…","ç´«ç´…","è”“è¶Šè“","è¦†ç›†å­","ç…™ç‡»ç²‰"] },
        { r:[340, 360],n:["ç²‰","æ«»ç²‰","è‰è“ç”œå¿ƒ","èŠ­æ¯”ç²‰","å°‘å¥³è‚Œ"] }
    ];

    let m = lib.find(x => h >= x.r[0] && h < x.r[1]) || lib[0];
    let v1 = m.n[0], v2 = m.n[1], v3 = m.n[2];

    // æ ¹æ“šæ˜åº¦(L)èˆ‡é£½å’Œåº¦(S)é€²è¡Œè©å½™åç§»
    if (s < 30) v3 = "è¿·éœ§" + m.n[0] + " (è«è˜­è¿ª)";
    else if (l < 30) v3 = m.n[2]; // æ·±è‰²é¸ç”¨é‡è‰²å
    else if (l > 75) v3 = m.n[3] || m.n[1]; // æ·ºè‰²é¸ç”¨è¼•ç›ˆå
    else if (s > 80) v3 = m.n[4] || m.n[2]; // é«˜å½©é¸ç”¨é®®è±”å

    // é¡å¤–é‡‘å±¬è³ªæ„Ÿåˆ¤å®š
    if (s > 15 && s < 40 && l > 40 && l < 70) {
        if (h > 40 && h < 60) v3 = "å¤éŠ…é‡‘";
        if (h > 180 && h < 220) v3 = "å¤ªç©ºéŠ€è—";
    }

    return {v1:v1+"ç³»", v2:v2, v3:v3};
}

function rgbToHsl(r,g,b){
    r/=255,g/=255,b/=255; let max=Math.max(r,g,b),min=Math.min(r,g,b),h,s,l=(max+min)/2;
    if(max==min)h=s=0;else{let d=max-min;s=l>0.5?d/(2-max-min):d/(max+min);
    switch(max){case r:h=(g-b)/d+(g<b?6:0);break;case g:h=(b-r)/d+2;break;case b:h=(r-g)/d+4;break;}h/=6;}
    return [h,s,l];
}
function hslToHex(h,s,l){
    l/=100;const a=s*Math.min(l,1-l)/100;const f=n=>{const k=(n+h/30)%12;const color=l-a*Math.max(Math.min(k-3,9-k,1),-1);
    return Math.round(255*color).toString(16).padStart(2,'0');};return `#${f(0)}${f(8)}${f(4)}`.toUpperCase();
}
</script>
</body>
</html>
