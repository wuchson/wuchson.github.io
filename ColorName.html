<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>é¡è‰²åç¨±åˆ¤å®šå™¨</title>
    <style>
        :root { --ink: #2c3e50; --gold: #d4af37; --bg: #fdfcfb; }
        body { background: var(--bg); font-family: "PingFang TC", sans-serif; margin: 0; display: flex; flex-direction: column; align-items: center; color: var(--ink); }
        .cam-view { width: 100%; max-width: 450px; aspect-ratio: 1; position: relative; background: #000; }
        #v { width: 100%; height: 100%; object-fit: cover; }
        .aimer { position: absolute; top: 50%; left: 50%; transform: translate(-50%, -50%); width: 20px; height: 20px; border: 1px solid white; border-radius: 50%; mix-blend-mode: difference; }
        
        .card { width: 92%; max-width: 450px; background: white; border-radius: 30px; padding: 25px; margin-top: -30px; box-shadow: 0 20px 40px rgba(0,0,0,0.1); z-index: 10; border: 1px solid #f0f0f0; }
        .swatch-box { display: flex; align-items: center; gap: 20px; margin-bottom: 25px; }
        #preview { width: 85px; height: 85px; border-radius: 25px; box-shadow: 0 8px 15px rgba(0,0,0,0.1); }
        
        .name-stack { flex: 1; }
        .lv-tag { font-size: 10px; color: #aaa; letter-spacing: 1px; }
        .lv-val { font-size: 18px; font-weight: 600; margin-bottom: 8px; color: var(--ink); }
        .lv-val.lv3 { color: #8e735b; font-family: serif; font-size: 20px; border-bottom: 1px solid #eee; padding-bottom: 5px; }

        .controls { margin-top: 20px; }
        .s-row { margin-bottom: 15px; }
        .s-head { display: flex; justify-content: space-between; font-size: 12px; color: #888; margin-bottom: 5px; }
        input[type=range] { width: 100%; height: 5px; appearance: none; background: #eee; border-radius: 10px; outline: none; }
        input[type=range]::-webkit-slider-thumb { appearance: none; width: 22px; height: 22px; background: white; border: 1px solid #ddd; border-radius: 50%; box-shadow: 0 3px 6px rgba(0,0,0,0.1); }

        .btn-row { display: flex; gap: 10px; width: 92%; max-width: 450px; margin: 20px 0; }
        button { flex: 1; padding: 15px; border-radius: 15px; border: none; font-weight: bold; cursor: pointer; transition: 0.2s; }
        .btn-main { background: var(--ink); color: white; }
        .btn-mo { background: #efebe9; color: #5d4037; }
    </style>
</head>
<body>

<div class="cam-view">
    <video id="v" autoplay playsinline></video>
    <div class="aimer"></div>
</div>

<div class="btn-row">
    <button class="btn-main" onclick="detect()">ğŸ“¸ æ“·å–è‰²å½©</button>
    <button class="btn-mo" onclick="makeMorandi()">âœ¨ è«è˜­è¿ªåŒ–</button>
</div>

<div class="card" id="res" style="display:none;">
    <div class="swatch-box">
        <div id="preview"></div>
        <div class="name-stack">
            <div class="lv-tag">è³ªæ„Ÿå‘½å</div>
            <div class="lv-val lv3" id="lv3">-</div>
            <div id="hex" style="font-family: monospace; font-size: 14px; color: #ccc;">#FFFFFF</div>
        </div>
    </div>
    
    <div class="lv-tag">å±¤æ¬¡åˆ†é¡</div>
    <div class="lv-val" id="lv1" style="font-size:14px; color:#888;">-</div>
    <div class="lv-val" id="lv2" style="font-size:16px;">-</div>

    <div class="controls">
        <div class="s-row">
            <div class="s-head"><span>æ˜åº¦èª¿æ•´</span><span id="lv">50%</span></div>
            <input type="range" id="ls" min="0" max="100" oninput="ui()">
        </div>
        <div class="s-row">
            <div class="s-head"><span>é£½å’Œåº¦</span><span id="sv">50%</span></div>
            <input type="range" id="ss" min="0" max="100" oninput="ui()">
        </div>
        <div style="text-align:center; font-size:11px; color:#ddd;">æ»‘å‹•æ»‘æ¡¿ï¼Œé«”é©—çµ²æ»‘å‘½åè®Šæ›</div>
    </div>
</div>

<canvas id="c" style="display:none;"></canvas>

<script>
let cH=0, cS=50, cL=50;
const v=document.getElementById('v'), c=document.getElementById('c'), ctx=c.getContext('2d');
navigator.mediaDevices.getUserMedia({video:{facingMode:"environment"}}).then(s=>v.srcObject=s);

function detect() {
    c.width=v.videoWidth; c.height=v.videoHeight;
    ctx.drawImage(v,0,0);
    const p=ctx.getImageData(c.width/2,c.height/2,1,1).data;
    const hsl=rgbToHsl(p[0],p[1],p[2]);
    cH=hsl[0]*360; cS=hsl[1]*100; cL=hsl[2]*100;
    document.getElementById('ls').value=cL;
    document.getElementById('ss').value=cS;
    ui();
}

function makeMorandi() { cS=25; document.getElementById('ss').value=25; ui(); }

function ui() {
    cL=parseInt(document.getElementById('ls').value);
    cS=parseInt(document.getElementById('ss').value);
    const hex=hslToHex(cH,cS,cL);
    document.getElementById('res').style.display='block';
    document.getElementById('preview').style.backgroundColor=hex;
    document.getElementById('hex').innerText=hex;
    document.getElementById('lv').innerText=cL+"%";
    document.getElementById('sv').innerText=cS+"%";

    const n = getNames(cH, cS, cL);
    document.getElementById('lv1').innerText=n.v1;
    document.getElementById('lv2').innerText=n.v2;
    document.getElementById('lv3').innerText=n.v3;
}

function getNames(h,s,l) {
    // åŸºç¤æ¥µé™åˆ¤å®š
    if (l > 96) return {v1:"ç„¡å½©è‰²", v2:"ç™½è‰²", v3:"ç´”æ·¨é›ªç´¡"};
    if (l < 8) return {v1:"ç„¡å½©è‰²", v2:"é»‘è‰²", v3:"ç„æ­¦å²©é»‘"};
    if (s < 10) {
        if (l > 75) return {v1:"ç°è‰²ç³»", v2:"æ·ºç°è‰²", v3:"æ™¨éœ§æš–ç°"};
        if (l < 35) return {v1:"ç°è‰²ç³»", v2:"æ·±ç°è‰²", v3:"æ¿å²©å†·ç°"};
        return {v1:"ç°è‰²ç³»", v2:"ä¸­ç°è‰²", v3:"è«è˜­è¿ªç°"};
    }

    // æœé£¾/è£¸è†šè‰²å€åŸŸ (H: 10-45)
    if (h > 10 && h < 45 && s < 45 && l > 55) {
        if (l > 85) return {v1:"è£¸è‰²ç³»", v2:"ç±³ç™½è‰²", v3:"è£¸ç´—è•¾çµ²"};
        if (l > 75) return {v1:"è£¸è‰²ç³»", v2:"æ·ºæè‰²", v3:"ææ¡ƒèœœç²‰"};
        if (s > 25) return {v1:"è£¸è‰²ç³»", v2:"å¥¶èŒ¶è‰²", v3:"æº«æ½¤æ‹¿éµ"};
        return {v1:"è£¸è‰²ç³»", v2:"è£¸è¤è‰²", v3:"å†·èƒæ­è•¾"};
    }

    // è‰²è¼ªç´°åˆ†å‘½åé‚è¼¯ (24ç­‰åˆ†)
    const sectors = [
        {h:15,  n:["ç´…è‰²","ç·‹ç´…","å¾®é†ºç«ç‘°"]},
        {h:30,  n:["æ©˜è‰²","çŠç‘šç²‰","è‚‰æ¡‚ç²‰"]},
        {h:45,  n:["èŒ¶è‰²","ç„¦ç³–","çƒ˜ç„™åå¸"]},
        {h:60,  n:["é»ƒè‰²","ç¥ç€","å¥¶æ²¹å¡å£«é”"]},
        {h:75,  n:["é»ƒç¶ ","å«©ç¶ ","åˆæ˜¥èŠ½ç¶ "]},
        {h:100, n:["ç¶ è‰²","è‰ç¶ ","è–„è·æ¸…æ™¨"]},
        {h:130, n:["ç¶ è‰²","æ£®æ—","æŠ¹èŒ¶æ…•æ–¯"]},
        {h:160, n:["é’ç¶ ","æ¹–æ°´è—","é´¨è›‹é’"]},
        {h:185, n:["é’è‰²","å­”é›€è—","è”šè—æ·±æµ·"]},
        {h:210, n:["è—è‰²","å¯¶è—","å‹¿å¿˜è‰è—"]},
        {h:230, n:["è—è‰²","è—é’","åˆå¤œçµ²çµ¨"]},
        {h:260, n:["ç´«è—","è–°è¡£è‰","è¿·éœ§æ£®æ—"]},
        {h:290, n:["ç´«è‰²","çµ³ç´«","è«å…§ç´«è—¤"]},
        {h:320, n:["ç´«ç´…","ç«ç´…","é‡è“ä¹¾æœ"]},
        {h:345, n:["ç²‰ç´…","æ«»èŠ±","ç”œå¿ƒèŠ­æ¯”"]}
    ];

    let match = sectors.find(x => h < x.h) || sectors[0];
    let v1 = match.n[0], v2 = match.n[1], v3 = match.n[2];

    // æ ¹æ“š S å’Œ L é€²è¡Œä¿®é£¾
    if (s < 35) { v2 = "è«è˜­è¿ª" + v1; v3 = "è¿·éœ§" + match.n[2]; }
    else if (l < 35) { v2 = "æ·±" + v1; v3 = "å¹½é‚ƒ" + match.n[1]; }
    else if (l > 75) { v2 = "ç²‰" + v1; v3 = "è¼•æŸ”" + match.n[2]; }

    return {v1, v2, v3};
}

function rgbToHsl(r,g,b){
    r/=255,g/=255,b/=255; let max=Math.max(r,g,b),min=Math.min(r,g,b),h,s,l=(max+min)/2;
    if(max==min)h=s=0;else{let d=max-min;s=l>0.5?d/(2-max-min):d/(max+min);
    switch(max){case r:h=(g-b)/d+(g<b?6:0);break;case g:h=(b-r)/d+2;break;case b:h=(r-g)/d+4;break;}h/=6;}
    return [h,s,l];
}
function hslToHex(h,s,l){
    l/=100;const a=s*Math.min(l,1-l)/100;const f=n=>{const k=(n+h/30)%12;const color=l-a*Math.max(Math.min(k-3,9-k,1),-1);
    return Math.round(255*color).toString(16).padStart(2,'0');};return `#${f(0)}${f(8)}${f(4)}`.toUpperCase();
}
</script>
</body>
</html>
