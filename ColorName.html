<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>è‰²å½©é‘‘å®šå™¨</title>
    <style>
        :root { --ink: #1a1a1c; --gold: #a67c52; --paper: #fcfaf8; }
        body { background: var(--paper); font-family: "PingFang TC", "STHeiti", sans-serif; margin: 0; display: flex; flex-direction: column; align-items: center; color: var(--ink); }
        .viewer-box { width: 100%; max-width: 450px; aspect-ratio: 1; position: relative; background: #000; overflow: hidden; }
        #v, #photo-canvas { width: 100%; height: 100%; object-fit: cover; position: absolute; }
        #photo-canvas { display: none; z-index: 5; cursor: crosshair; }
        .aimer { position: absolute; top: 50%; left: 50%; transform: translate(-50%, -50%); width: 16px; height: 16px; border: 2px solid #fff; border-radius: 50%; mix-blend-mode: difference; z-index: 10; pointer-events: none; }
        
        .card { width: 94%; max-width: 450px; background: white; border-radius: 40px; padding: 30px 25px; margin-top: -40px; box-shadow: 0 20px 60px rgba(0,0,0,0.12); z-index: 20; box-sizing: border-box; text-align: center; }
        
        /* è‰²ç¥¨é è¦½å€ï¼šå¢åŠ é»æ“Šæç¤º */
        #preview { width: 110px; height: 110px; border-radius: 50%; margin: 0 auto 15px; border: 6px solid #fff; box-shadow: 0 10px 25px rgba(0,0,0,0.1); cursor: pointer; transition: transform 0.1s; }
        #preview:active { transform: scale(0.95); }

        .name-main { font-size: 36px; font-weight: 900; color: #000; letter-spacing: -1px; }
        .name-sub { font-size: 14px; color: var(--gold); letter-spacing: 2px; font-weight: 600; margin-bottom: 10px; }
        
        /* HEX è¤‡è£½æŒ‰éˆ•æ¨£å¼ */
        #hex { font-family: "Courier New", monospace; font-size: 16px; color: #999; margin-bottom: 20px; display: inline-block; padding: 5px 15px; background: #f0f0f0; border-radius: 20px; cursor: pointer; transition: 0.2s; }
        #hex:hover { background: #e0e0e0; color: var(--gold); }
        #hex:active { background: #d0d0d0; }

        .controls { background: #f8f8f8; padding: 20px; border-radius: 25px; }
        .s-row { margin-bottom: 15px; }
        .s-info { display: flex; justify-content: space-between; font-size: 11px; color: #999; margin-bottom: 5px; font-weight: bold; }
        input[type=range] { width: 100%; height: 4px; appearance: none; background: #eee; outline: none; border-radius: 2px; }
        input[type=range]::-webkit-slider-thumb { appearance: none; width: 24px; height: 24px; background: #fff; border: 1px solid var(--gold); border-radius: 50%; cursor: pointer; }

        .btn-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 10px; width: 94%; max-width: 450px; margin: 15px 0; }
        button { padding: 18px; border-radius: 18px; border: none; font-weight: 800; cursor: pointer; font-size: 14px; }
        .btn-black { background: var(--ink); color: white; grid-column: span 2; }
        .btn-outline { background: #fff; color: #666; border: 1px solid #ddd; }
        .active-mo { background: #f0e6dd; border-color: var(--gold); color: var(--gold); }

        /* è¤‡è£½æˆåŠŸçš„é€šçŸ¥å°è¦–çª— */
        #toast { position: fixed; bottom: 50px; background: rgba(0,0,0,0.8); color: white; padding: 10px 25px; border-radius: 30px; font-size: 14px; opacity: 0; transition: 0.3s; pointer-events: none; z-index: 100; }
    </style>
</head>
<body>

<div id="toast">å·²è¤‡è£½è‰²ç¥¨ä»£ç¢¼</div>

<div class="viewer-box" id="viewer" onclick="pickColor(event)">
    <video id="v" autoplay playsinline></video>
    <canvas id="photo-canvas"></canvas>
    <div class="aimer" id="aim"></div>
</div>

<div class="btn-grid">
    <button class="btn-black" onclick="detect()">ğŸ“¸ æ“·å–ç•¶å‰è‰²å½©</button>
    <button class="btn-outline" onclick="document.getElementById('file-in').click()">ğŸ“ é–‹å•Ÿç›¸ç‰‡é‘‘å®š</button>
    <button class="btn-outline" id="mo-btn" onclick="toggleMorandi()">âœ¨ è«è˜­è¿ªåŒ–</button>
    <input type="file" id="file-in" hidden accept="image/*" onchange="handleFile(event)">
</div>

<div class="card" id="res" style="display:none;">
    <div id="preview" title="é»æ“Šè¤‡è£½è‰²ç¥¨" onclick="copyHex()"></div>
    <div class="name-main" id="lv3">-</div>
    <div class="name-sub" id="lv2">-</div>
    <span id="hex" onclick="copyHex()">#FFFFFF</span>
    
    <div class="controls">
        <div class="s-row">
            <div class="s-info"><span>ç´°ç¯€äº®åº¦ (L)</span><span id="lv">50%</span></div>
            <input type="range" id="ls" min="0" max="100" oninput="ui()">
        </div>
        <div class="s-row">
            <div class="s-info"><span>è‰²å½©ç´”åº¦ (S)</span><span id="sv">50%</span></div>
            <input type="range" id="ss" min="0" max="100" oninput="ui()">
        </div>
    </div>
</div>

<canvas id="proc" style="display:none;"></canvas>

<script>
let cH=0, cS=50, cL=50, backupS=50, isPhoto=false;
const v=document.getElementById('v'), pCanvas=document.getElementById('photo-canvas'), pCtx=pCanvas.getContext('2d');
const procCanvas=document.getElementById('proc'), procCtx=procCanvas.getContext('2d');

navigator.mediaDevices.getUserMedia({video:{facingMode:"environment"}}).then(s=>v.srcObject=s);

const SUPREME_DICT = [
    {h:10,  n:"ç´…",   items:["ç¡ƒç ‚","ç·‹ç´…","èƒ­è„‚","èŒœè‰²","å‹ƒè‰®ç¬¬"]},
    {h:20,  n:"çŠç‘š", items:["èµ¤æ©˜","è‚‰æ¡‚","çŠç‘šç´…","æŸ¿ç´…","é®­é­šç²‰"]},
    {h:30,  n:"ç²‰è¤", items:["èœœç²‰","è£¸ç´—","ææ¡ƒ","ç²‰é»›","è†šç²‰"]},
    {h:40,  n:"è†š/å¥¶",items:["è±¡ç‰™","å¥¶èŒ¶","æ‹¿éµ","è‡ªç„¶è†š","ç‡•éº¥"]},
    {h:50,  n:"å¤§åœ°", items:["å¡å…¶","ç„¦ç³–","èƒ¡æ¡ƒ","æ‘©å¡","èµ­çŸ³"]},
    {h:60,  n:"é‡‘é»ƒ", items:["é¦™æª³é‡‘","å¥¶æ²¹","ç¥ç€","æ¢”å­","ç§‹è‘µ"]},
    {h:70,  n:"æ˜é»ƒ", items:["å‘æ—¥è‘µ","èŠ¥æœ«","å«ç¾è‰","è—¤é»ƒ","é‡‘ç›"]},
    {h:85,  n:"é»ƒç¶ ", items:["å«©èŠ½","èŠå§†","é’è˜‹æœ","èŒ¶ç¶ ","é¶¯è‰²"]},
    {h:105, n:"è‰ç¶ ", items:["è‹¥ç«¹","è‰æœ¬","è‹”è˜š","é’è”¥","è‰¾è‰"]},
    {h:125, n:"ç¿ ç¶ ", items:["ç¿¡ç¿ ","è–„è·","å­”é›€ç¶ ","ç¢§è‰²","å¸¸ç£"]},
    {h:145, n:"æ·±ç¶ ", items:["æ£®æ—","æŠ¹èŒ¶","é’ç“·","å¢¨ç¶ ","æ¾æŸ"]},
    {h:165, n:"é’ç¶ ", items:["æ¹–ç¶ ","é´¨è›‹é’","è’‚èŠ¬å¦®","ç¢§ç‰","æµ·ç»"]},
    {h:185, n:"é’è—", items:["è”šè—","æ°´è‰²","åƒè‰","å¤©è—","æ¹›è—"]},
    {h:205, n:"æ­£è—", items:["å¯¶è—","å‹¿å¿˜è‰","éœ§éœ¾è—","é›è—","ç‰ç’ƒ"]},
    {h:225, n:"æ·±è—", items:["è—é’","æ™®é­¯å£«è—","åˆå¤œè—","å‹è‰²","ç´ºé’"]},
    {h:245, n:"è—ç´«", items:["é³¶å°¾","è–°è¡£è‰","è¿·å¹»è—","è—¤è‰²","ç´«ç¾…è˜­"]},
    {h:265, n:"æ­£ç´«", items:["ç´«è—¤","ä¸é¦™","çµ³ç´«","æ¡”æ¢—","è‘¡è„"]},
    {h:285, n:"æ·±ç´«", items:["æ¡‘è‘š","å¢¨ç´«","èŒ„ç´«","å¤ç´«","æš—é¦™"]},
    {h:310, n:"ç«ç´…", items:["è¦†ç›†å­","é‡è“","ç«ç‘°ç´…","ç‰¡ä¸¹","æ´‹ç´…"]},
    {h:330, n:"ç²‰ç´…", items:["æ«»èŠ±","å°‘å¥³ç²‰","èŠ­æ¯”ç²‰","ç²‰é»›","æ´—æŸ¿"]},
    {h:350, n:"èµ¤ç´…", items:["è“æœ","é¶´èµ¤","ç«é¶´","ç´…å¯¶çŸ³","èµ¤é‡‘"]}
];

function handleFile(e) {
    const r = new FileReader();
    r.onload = (ev) => {
        const img = new Image();
        img.onload = () => {
            pCanvas.style.display = 'block';
            pCanvas.width = img.width; pCanvas.height = img.height;
            pCtx.drawImage(img, 0, 0);
            isPhoto = true; document.getElementById('aim').style.display='none';
        };
        img.src = ev.target.result;
    };
    r.readAsDataURL(e.target.files[0]);
}

function pickColor(e) {
    if(!isPhoto) return;
    const r = pCanvas.getBoundingClientRect();
    const x = (e.clientX - r.left) * (pCanvas.width / r.width);
    const y = (e.clientY - r.top) * (pCanvas.height / r.height);
    const d = pCtx.getImageData(x, y, 1, 1).data;
    update(d[0], d[1], d[2]);
}

function detect() {
    isPhoto = false; pCanvas.style.display='none';
    document.getElementById('aim').style.display='block';
    procCanvas.width=v.videoWidth; procCanvas.height=v.videoHeight;
    procCtx.drawImage(v,0,0);
    const d=procCtx.getImageData(procCanvas.width/2,procCanvas.height/2,1,1).data;
    update(d[0], d[1], d[2]);
}

function update(r, g, b) {
    const hsl = rgbToHsl(r, g, b);
    cH=hsl[0]*360; cS=hsl[1]*100; cL=hsl[2]*100; backupS=cS;
    document.getElementById('ls').value=cL; document.getElementById('ss').value=cS;
    ui();
}

function toggleMorandi() {
    const b = document.getElementById('mo-btn');
    if(!b.classList.contains('active-mo')){
        backupS=cS; cS=25; b.classList.add('active-mo'); b.innerText="âª é‚„åŸ";
    } else {
        cS=backupS; b.classList.remove('active-mo'); b.innerText="âœ¨ è«è˜­è¿ªåŒ–";
    }
    document.getElementById('ss').value=cS; ui();
}

// è¤‡è£½è‰²ç¥¨ä»£ç¢¼
function copyHex() {
    const hexVal = document.getElementById('hex').innerText;
    navigator.clipboard.writeText(hexVal).then(() => {
        const toast = document.getElementById('toast');
        toast.innerText = `å·²è¤‡è£½è‰²ç¥¨: ${hexVal}`;
        toast.style.opacity = '1';
        setTimeout(() => { toast.style.opacity = '0'; }, 1500);
    });
}

function ui() {
    cL=parseInt(document.getElementById('ls').value);
    cS=parseInt(document.getElementById('ss').value);
    const hex=hslToHex(cH,cS,cL);
    document.getElementById('res').style.display='block';
    document.getElementById('preview').style.backgroundColor=hex;
    document.getElementById('hex').innerText=hex;
    document.getElementById('lv').innerText=cL+"%";
    document.getElementById('sv').innerText=cS+"%";

    const n = getEvolutionaryName(cH, cS, cL);
    document.getElementById('lv3').innerText = n.v3;
    document.getElementById('lv2').innerText = n.v2;
}

function getEvolutionaryName(h, s, l) {
    if (l > 96) return {v3:"çš“é›ªç„¡ç‘•", v2:"High-End Purest White"};
    if (l < 6) return {v3:"æ¥µå¤œæ·±æ·µ", v2:"Absolute Deep Black"};
    if (s < 8) {
        if (l > 85) return {v3:"éŠ€ç‹æ™¨éœ§", v2:"Light Mist Gray"};
        if (l > 65) return {v3:"è«è˜­è¿ªä¸­ç°", v2:"Muted Neutral Gray"};
        if (l > 35) return {v3:"ç„æ­¦å²©å†·ç°", v2:"Deep Slate Gray"};
        return {v3:"ç‚­å¢¨å½±é»‘", v2:"Charcoal Ink"};
    }
    let target = SUPREME_DICT.find(x => h < x.h) || SUPREME_DICT[SUPREME_DICT.length-1];
    let prefix = "";
    if (s < 30) prefix = "è¿·éœ§";
    else if (s > 85) prefix = "æ¥µè‡´";
    else if (l > 80) prefix = "æ¸…é€";
    else if (l < 30) prefix = "å¹½é‚ƒ";
    else prefix = "é›…ç·»";
    let itemIdx = Math.min(Math.floor(l / 20), 4);
    let base = target.items[itemIdx];
    if (h > 15 && h < 48 && s < 50) {
        const skins = ["é€ç²‰è£¸ç´—","èœœç²‰ææ¡ƒ","æº«æ½¤æ‹¿éµ","æ³•å¼å¯å¯","å†·èƒæ­è•¾"];
        base = skins[itemIdx];
        prefix = (s < 25) ? "è«è˜­è¿ª" : (l > 75) ? "è¼•ç›ˆ" : "";
    }
    return { v3: prefix + base, v2: `å°ˆæ¥­${target.n}è‰²è­œ Â· é»æ“Šè‰²ç¥¨è¤‡è£½ä»£ç¢¼` };
}

function rgbToHsl(r,g,b){r/=255,g/=255,b/=255;let max=Math.max(r,g,b),min=Math.min(r,g,b),h,s,l=(max+min)/2;if(max==min)h=s=0;else{let d=max-min;s=l>0.5?d/(2-max-min):d/(max+min);switch(max){case r:h=(g-b)/d+(g<b?6:0);break;case g:h=(b-r)/d+2;break;case b:h=(r-g)/d+4;break;}h/=6;}return [h,s,l];}
function hslToHex(h,s,l){l/=100;const a=s*Math.min(l,1-l)/100;const f=n=>{const k=(n+h/30)%12;const color=l-a*Math.max(Math.min(k-3,9-k,1),-1);return Math.round(255*color).toString(16).padStart(2,'0');};return `#${f(0)}${f(8)}${f(4)}`.toUpperCase();}
</script>
</body>
</html>
