<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>é¡è‰²é‘‘å®šå™¨</title>
    <style>
        :root { --ink: #0f172a; --gold: #926b4e; --slate: #64748b; --silk: #f8fafc; }
        body { background: var(--silk); font-family: "PingFang TC", "Hiragino Mincho ProN", serif; margin: 0; display: flex; flex-direction: column; align-items: center; color: var(--ink); }
        
        .viewer-container { width: 100%; max-width: 450px; aspect-ratio: 1; position: relative; background: #000; overflow: hidden; cursor: crosshair; }
        #v, #photo-canvas { width: 100%; height: 100%; object-fit: cover; position: absolute; top: 0; left: 0; }
        #photo-canvas { display: none; z-index: 5; }
        .aimer { position: absolute; top: 50%; left: 50%; transform: translate(-50%, -50%); width: 20px; height: 20px; border: 2px solid #fff; border-radius: 50%; mix-blend-mode: difference; z-index: 10; pointer-events: none; }

        .card { width: 94%; max-width: 450px; background: white; border-radius: 40px 40px 30px 30px; padding: 30px 20px; margin-top: -50px; box-shadow: 0 20px 50px rgba(0,0,0,0.1); z-index: 20; box-sizing: border-box; text-align: center; }
        #preview { width: 100px; height: 100px; border-radius: 50%; margin: 0 auto 15px; border: 6px solid #fff; box-shadow: 0 10px 20px rgba(0,0,0,0.08); }
        
        .name-main { font-size: 32px; font-weight: 900; color: var(--ink); margin-bottom: 5px; }
        .name-sub { font-size: 13px; color: var(--gold); letter-spacing: 2px; font-weight: 600; }

        .controls { background: #f1f5f9; padding: 20px; border-radius: 25px; margin-top: 20px; }
        .s-row { margin-bottom: 15px; }
        .s-info { display: flex; justify-content: space-between; font-size: 11px; color: var(--slate); margin-bottom: 5px; }
        input[type=range] { width: 100%; height: 4px; appearance: none; background: #cbd5e1; outline: none; }
        input[type=range]::-webkit-slider-thumb { appearance: none; width: 22px; height: 22px; background: #fff; border: 2px solid var(--gold); border-radius: 50%; }

        .btn-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 10px; width: 94%; max-width: 450px; margin: 15px 0; }
        button { padding: 16px; border-radius: 15px; border: none; font-weight: 800; cursor: pointer; font-size: 14px; transition: 0.2s; }
        .btn-black { background: var(--ink); color: white; grid-column: span 2; font-size: 16px; }
        .btn-outline { background: #fff; color: var(--gold); border: 1px solid #e2e8f0; }
        .btn-active { background: #efebe9; border-color: var(--gold); }
    </style>
</head>
<body>

<div class="viewer-container" id="viewer" onclick="pickColor(event)">
    <video id="v" autoplay playsinline></video>
    <canvas id="photo-canvas"></canvas>
    <div class="aimer" id="aim"></div>
</div>

<div class="btn-grid">
    <button class="btn-black" onclick="detect()">ğŸ“¸ æ“·å–ç•«é¢é¡è‰²</button>
    <button class="btn-outline" onclick="document.getElementById('file-in').click()">ğŸ“ é–‹å•Ÿç›¸ç‰‡</button>
    <button class="btn-outline" id="mo-btn" onclick="toggleMorandi()">âœ¨ è«è˜­è¿ªåŒ–</button>
    <input type="file" id="file-in" hidden accept="image/*" onchange="handleFile(event)">
</div>

<div class="card" id="res" style="display:none;">
    <div id="preview"></div>
    <div class="name-main" id="lv3">-</div>
    <div class="name-sub" id="lv2">-</div>
    <div id="hex" style="font-family:monospace; color:#ccc; margin-top:10px;">#FFFFFF</div>
    
    <div class="controls">
        <div class="s-row">
            <div class="s-info"><span>æ˜åº¦ (L)</span><span id="lv">50%</span></div>
            <input type="range" id="ls" min="0" max="100" oninput="ui()">
        </div>
        <div class="s-row">
            <div class="s-info"><span>é£½å’Œåº¦ (S)</span><span id="sv">50%</span></div>
            <input type="range" id="ss" min="0" max="100" oninput="ui()">
        </div>
    </div>
</div>

<canvas id="process-canvas" style="display:none;"></canvas>

<script>
let cH=0, cS=50, cL=50, backupS=50, isPhoto=false;
const v=document.getElementById('v'), pCanvas=document.getElementById('photo-canvas'), pCtx=pCanvas.getContext('2d');
const procCanvas=document.getElementById('process-canvas'), procCtx=procCanvas.getContext('2d');

navigator.mediaDevices.getUserMedia({video:{facingMode:"environment"}}).then(s=>v.srcObject=s);

function handleFile(e) {
    const reader = new FileReader();
    reader.onload = function(event) {
        const img = new Image();
        img.onload = function() {
            pCanvas.style.display = 'block';
            pCanvas.width = img.width; pCanvas.height = img.height;
            pCtx.drawImage(img, 0, 0);
            isPhoto = true;
            document.getElementById('aim').style.display = 'none';
            alert("å·²è¼‰å…¥ç›¸ç‰‡ï¼Œé»æ“Šåœ–ç‰‡ä»»ä½•ä½ç½®å³å¯é‘‘å®šé¡è‰²");
        }
        img.src = event.target.result;
    }
    reader.readAsDataURL(e.target.files[0]);
}

function pickColor(e) {
    if(!isPhoto) return;
    const rect = pCanvas.getBoundingClientRect();
    const x = (e.clientX - rect.left) * (pCanvas.width / rect.width);
    const y = (e.clientY - rect.top) * (pCanvas.height / rect.height);
    const p = pCtx.getImageData(x, y, 1, 1).data;
    updateByRGB(p[0], p[1], p[2]);
}

function detect() {
    isPhoto = false;
    pCanvas.style.display = 'none';
    document.getElementById('aim').style.display = 'block';
    procCanvas.width = v.videoWidth; procCanvas.height = v.videoHeight;
    procCtx.drawImage(v, 0, 0);
    const p = procCtx.getImageData(procCanvas.width/2, procCanvas.height/2, 1, 1).data;
    updateByRGB(p[0], p[1], p[2]);
}

function updateByRGB(r, g, b) {
    const hsl = rgbToHsl(r, g, b);
    cH = hsl[0]*360; cS = hsl[1]*100; cL = hsl[2]*100; backupS = cS;
    document.getElementById('ls').value = cL;
    document.getElementById('ss').value = cS;
    ui();
}

function toggleMorandi() {
    const btn = document.getElementById('mo-btn');
    if(!btn.classList.contains('btn-active')){
        backupS=cS; cS=25; btn.classList.add('btn-active'); btn.innerText = "âª é‚„åŸ";
    } else {
        cS=backupS; btn.classList.remove('btn-active'); btn.innerText = "âœ¨ è«è˜­è¿ªåŒ–";
    }
    document.getElementById('ss').value=cS; ui();
}

function ui() {
    cL=parseInt(document.getElementById('ls').value);
    cS=parseInt(document.getElementById('ss').value);
    const hex=hslToHex(cH,cS,cL);
    document.getElementById('res').style.display='block';
    document.getElementById('preview').style.backgroundColor=hex;
    document.getElementById('hex').innerText=hex;
    document.getElementById('lv').innerText=cL+"%";
    document.getElementById('sv').innerText=cS+"%";

    const n = generateVastName(cH, cS, cL);
    document.getElementById('lv3').innerText = n.v3;
    document.getElementById('lv2').innerText = n.v2;
}

function generateVastName(h, s, l) {
    if (l > 94) return {v3:"é›ªç´¡ç´”ç™½", v2:"High-End Silk White"};
    if (l < 7) return {v3:"æ›œçŸ³æ¥µé»‘", v2:"Obsidian Dark Collection"};
    const library = [
        {h: 12,  n:"ç´…",  items:["èƒ­è„‚", "ç·‹ç´…", "å‹ƒè‰®ç¬¬", "è”“è¶Šè“", "å¤•é™½ç´…"]},
        {h: 25,  n:"çŠç‘š",items:["èµ¤æ©˜", "å¤•é™½", "çŠç‘š", "æœ±ç ‚", "æŸ¿å­ç´…"]},
        {h: 42,  n:"è†š/è£¸",items:["ææ¡ƒ", "èœœç²‰", "è£¸ç´—", "å¥¶èŒ¶", "å¡å…¶"]},
        {h: 55,  n:"æ£•/åœŸ",items:["ç„¦ç³–", "èƒ¡æ¡ƒ", "å¯å¯", "ç¥ç€", "æ‘©å¡"]},
        {h: 70,  n:"é»ƒ/é‡‘",items:["é¦™æª³", "å¥¶æ²¹", "æª¸æª¬", "å‘æ—¥è‘µ", "é‡‘ç›"]},
        {h: 110, n:"å«©ç¶ ",items:["è‰¾è‰", "èŠ½ç¶ ", "é’è˜‹æœ", "èŠå§†", "æ©„æ¬–"]},
        {h: 150, n:"æ·±ç¶ ",items:["ç¿¡ç¿ ", "æ£®æ—", "æŠ¹èŒ¶", "å­”é›€ç¶ ", "è–„è·"]},
        {h: 185, n:"é’è—",items:["è’‚èŠ¬å¦®", "é´¨è›‹", "æ¹–æ°´", "é’ç“·", "ç¢§è—"]},
        {h: 215, n:"æ¹›è—",items:["è”šè—", "å‹¿å¿˜è‰", "éœ§éœ¾è—", "æ™®é­¯å£«", "è—é’"]},
        {h: 265, n:"è—ç´«",items:["é›é’", "é³¶å°¾", "è–°è¡£è‰", "è¿·å¹»è—", "ç‰ç’ƒ"]},
        {h: 300, n:"ç´«è‰²",items:["çµ³ç´«", "ä¸é¦™", "æ¡‘è‘š", "è¿·éœ§ç´«", "è‘¡è„"]},
        {h: 340, n:"ç«ç²‰",items:["æ«»èŠ±", "ç«ç‘°", "å°‘å¥³", "ç´…é…’", "èŠ­æ¯”"]}
    ];
    if (s < 10) {
        const greyPrefix = l > 80 ? "æ™¨éœ§" : l > 50 ? "è«è˜­è¿ª" : "æ¿å²©";
        return {v3: greyPrefix + "å²©ç°", v2: "Minimalist Gray Aesthetic"};
    }
    let sector = library.find(x => h < x.h) || library[0];
    let prefix = (l > 82) ? "æ¸…é€" : (l > 65) ? "æŸ”å’Œ" : (s < 32) ? "è¿·éœ§" : (l < 38) ? "å¹½é‚ƒ" : (s > 75) ? "æ¥µè‡´" : "ç¶“å…¸";
    let baseIdx = Math.min(Math.floor(l / 20), 4);
    let baseName = sector.items[baseIdx];
    if (h >= 15 && h <= 50 && s < 48) {
        const skins = ["é€ç²‰è£¸ç´—", "èœœç²‰ææ¡ƒ", "æš–é™½å¥¶èŒ¶", "æ³•å¼å¯å¯", "å†·èƒæ­è•¾"];
        return {v3: skins[Math.floor(l/20)] || "æ¥µè‡´è£¸è†š", v2: "Lingerie Skin Collection"};
    }
    return { v3: prefix + baseName + (s < 28 ? "ç°" : ""), v2: `${sector.n}è‰²ç³» Â· è³ªæ„Ÿèªæ„ç³»çµ±` };
}

function rgbToHsl(r,g,b){r/=255,g/=255,b/=255;let max=Math.max(r,g,b),min=Math.min(r,g,b),h,s,l=(max+min)/2;if(max==min)h=s=0;else{let d=max-min;s=l>0.5?d/(2-max-min):d/(max+min);switch(max){case r:h=(g-b)/d+(g<b?6:0);break;case g:h=(b-r)/d+2;break;case b:h=(r-g)/d+4;break;}h/=6;}return [h,s,l];}
function hslToHex(h,s,l){l/=100;const a=s*Math.min(l,1-l)/100;const f=n=>{const k=(n+h/30)%12;const color=l-a*Math.max(Math.min(k-3,9-k,1),-1);return Math.round(255*color).toString(16).padStart(2,'0');};return `#${f(0)}${f(8)}${f(4)}`.toUpperCase();}
</script>
</body>
</html>
