<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>é¡è‰²åç¨±åˆ¤å®šå™¨</title>
    <style>
        :root { --ink: #1a1a1c; --gold: #b3935d; --paper: #f9f9fb; }
        body { background: var(--paper); font-family: "PingFang TC", "STHeiti", sans-serif; margin: 0; display: flex; flex-direction: column; align-items: center; color: var(--ink); }
        .cam-view { width: 100%; max-width: 450px; aspect-ratio: 1; position: relative; background: #000; }
        #v { width: 100%; height: 100%; object-fit: cover; }
        .aimer { position: absolute; top: 50%; left: 50%; transform: translate(-50%, -50%); width: 20px; height: 20px; border: 2px solid #fff; border-radius: 50%; mix-blend-mode: difference; z-index: 10; }
        
        .card { width: 94%; max-width: 450px; background: white; border-radius: 30px; padding: 25px; margin-top: -30px; box-shadow: 0 20px 50px rgba(0,0,0,0.1); z-index: 20; box-sizing: border-box; }
        .swatch-row { display: flex; align-items: center; gap: 20px; margin-bottom: 20px; }
        #preview { width: 85px; height: 85px; border-radius: 25px; box-shadow: inset 0 0 0 1px rgba(0,0,0,0.05); }
        
        .name-main { font-size: 28px; font-weight: 800; color: #111; margin-bottom: 5px; letter-spacing: -1px; }
        .name-sub { font-size: 14px; color: var(--gold); font-weight: 600; margin-bottom: 15px; }

        .btn-row { display: flex; gap: 10px; width: 94%; max-width: 450px; margin: 15px 0; }
        button { flex: 1; padding: 16px; border-radius: 12px; border: none; font-weight: bold; cursor: pointer; font-size: 14px; }
        .btn-p { background: var(--ink); color: white; }
        .btn-m { background: #efebe9; color: #5d4037; }
        
        .sliders { background: #fcfcfc; padding: 20px; border-radius: 20px; border: 1px solid #f0f0f0; }
        .s-item { margin-bottom: 15px; }
        .s-info { display: flex; justify-content: space-between; font-size: 11px; color: #999; margin-bottom: 5px; }
        input[type=range] { width: 100%; height: 4px; appearance: none; background: #eee; outline: none; }
        input[type=range]::-webkit-slider-thumb { appearance: none; width: 24px; height: 24px; background: #fff; border: 1px solid #ddd; border-radius: 50%; box-shadow: 0 2px 6px rgba(0,0,0,0.1); }
    </style>
</head>
<body>

<div class="cam-view">
    <video id="v" autoplay playsinline></video>
    <div class="aimer"></div>
</div>

<div class="btn-row">
    <button class="btn-p" onclick="detect()">ğŸ“¸ æ“·å–ç²¾ç¢ºè‰²å½©</button>
    <button class="btn-m" id="mo-btn" onclick="toggleMorandi()">âœ¨ è«è˜­è¿ªåŒ–</button>
</div>

<div class="card" id="res" style="display:none;">
    <div class="swatch-row">
        <div id="preview"></div>
        <div style="flex:1">
            <div id="hex" style="font-family: monospace; font-size: 12px; color: #ccc;">#FFFFFF</div>
            <div class="name-main" id="lv3">-</div>
            <div class="name-sub" id="lv2">-</div>
        </div>
    </div>
    
    <div class="sliders">
        <div class="s-item">
            <div class="s-info"><span>äº®åº¦ (L) - å½±éŸ¿è‰²ç›¸æ·±æ·º</span><span id="lv">50%</span></div>
            <input type="range" id="ls" min="0" max="100" oninput="ui()">
        </div>
        <div class="s-item">
            <div class="s-info"><span>é£½å’Œåº¦ (S) - å½±éŸ¿ç°åº¦è³ªæ„Ÿ</span><span id="sv">50%</span></div>
            <input type="range" id="ss" min="0" max="100" oninput="ui()">
        </div>
    </div>
</div>

<canvas id="c" style="display:none;"></canvas>

<script>
let cH=0, cS=50, cL=50, backupS=50;
const v=document.getElementById('v'), c=document.getElementById('c'), ctx=c.getContext('2d');
navigator.mediaDevices.getUserMedia({video:{facingMode:"environment"}}).then(s=>v.srcObject=s);

function detect() {
    c.width=v.videoWidth; c.height=v.videoHeight;
    ctx.drawImage(v,0,0);
    const p=ctx.getImageData(c.width/2,c.height/2,1,1).data;
    const hsl=rgbToHsl(p[0],p[1],p[2]);
    cH=hsl[0]*360; cS=hsl[1]*100; cL=hsl[2]*100; backupS=cS;
    document.getElementById('ls').value=cL; document.getElementById('ss').value=cS;
    ui();
}

function toggleMorandi() {
    if(cS>30){backupS=cS; cS=25;} else {cS=backupS;}
    document.getElementById('ss').value=cS; ui();
}

function ui() {
    cL=parseInt(document.getElementById('ls').value);
    cS=parseInt(document.getElementById('ss').value);
    const hex=hslToHex(cH,cS,cL);
    document.getElementById('res').style.display='block';
    document.getElementById('preview').style.backgroundColor=hex;
    document.getElementById('hex').innerText=hex;
    document.getElementById('lv').innerText=cL+"%";
    document.getElementById('sv').innerText=cS+"%";

    const n = getComprehensiveName(cH, cS, cL);
    document.getElementById('lv3').innerText = n.v3;
    document.getElementById('lv2').innerText = n.v2;
}

function getComprehensiveName(h, s, l) {
    // 1. æ¥µè‡´ç„¡å½©è‰²åˆ¤å®š
    if (l > 95) return {v3:"ç´”æ·¨é›ªç´¡", v2:"æ¥µè‡´ç™½è‰²ç³»"};
    if (l < 8) return {v3:"é»‘æ›œæ¼†çŸ³", v2:"æ¥µè‡´é»‘è‰²ç³»"};
    if (s < 10) {
        if (l > 80) return {v3:"æ™¨éœ²é›²ç…™", v2:"æ·ºäº®ç°è‰²"};
        if (l > 55) return {v3:"è«è˜­è¿ªå²©ç°", v2:"ä¸­æ€§ç°è‰²"};
        if (l > 30) return {v3:"æ¿å²©å†·ç°", v2:"æ·±æ²‰ç°è‰²"};
        return {v3:"ç„æ­¦å²©ç°", v2:"æ¥µæ·±ç°è‰²"};
    }

    // 2. è†šè‰²ã€é‡‘å±¬ã€è«è˜­è¿ªé«˜åº¦ç´°åˆ†æ¼”ç®—æ³•
    // æ¯å€‹ Hue å€é–“å®šç¾© [è¶…æ·º(ç²‰/ç™½), æ·º(è«è˜­è¿ª), ä¸­(é®®è‰·), æ·±(æš—è‰²)]
    const dictionary = [
        {h: 15, names:["ç²‰ç™½æ«»èŠ±", "è¿·éœ§èƒ­è„‚", "ç·‹ç´…ç«ç„°", "å‹ƒè‰®ç¬¬é…’ç´…"]}, //ç´…
        {h: 35, names:["èœœç²‰ææ¡ƒ", "å¥¶èŒ¶è£¸è†š", "çŠç‘šäº®æ©˜", "ç„¦ç³–ç¥ç€"]}, //ç²‰æ©˜/è†š
        {h: 50, names:["é¦™æª³è£¸ç´—", "ç‡•éº¥åœŸè‰²", "æ²‰ç©©èµ­çŸ³", "é»‘å·§å…‹åŠ›"]}, //å¤§åœ°/æ£•
        {h: 65, names:["è±¡ç‰™å¥¶éœœ", "é™¶å¯æ·ºé»ƒ", "å‘æ—¥è‘µé»ƒ", "å¤éŠ…é‡‘"]},   //é»ƒ/é‡‘
        {h: 90, names:["æ¸…é€æª¸ç¶ ", "è‰¾è‰è«è˜­è¿ª", "èŠå§†å«©ç¶ ", "æ©„æ¬–ç¶ "]}, //é»ƒç¶ 
        {h: 125, names:["è–„è·æ¸…æ™¨", "é¼ å°¾è‰ç¶ ", "ç¿¡ç¿ çµ²çµ¨", "æ£®æ—ç§˜å¢ƒ"]}, //ç¶ 
        {h: 160, names:["å†°æ™¶è—ç¶ ", "é´¨è›‹é’", "å­”é›€ç¢§ç¶ ", "æ™®é­¯å£«ç¶ "]}, //é’ç¶ 
        {h: 190, names:["å¤¢å¹»æ¹–è—", "éœ§éœ¾è—", "è’‚èŠ¬å¦®è—", "æ·±æµ·è—"]},   //é’è—
        {h: 220, names:["å‹¿å¿˜è‰è—", "åŒ—æ­å†·è—", "åœ°ä¸­æµ·è”šè—", "åˆå¤œè—é’"]}, //è—
        {h: 260, names:["çµ²çµ¨ç´«è˜­", "è–°è¡£è‰ç°", "çš‡å®¶å¯¶è—", "é›é’é»‘"]},   //è—ç´«
        {h: 290, names:["ä¸é¦™ç´«", "è¿·éœ§ç´«", "æ¥µè‡´çµ³ç´«", "é»‘é†‹æ —ç´«"]},   //ç´«
        {h: 330, names:["é‡è“ç²‰", "ç…™ç‡»ç«ç‘°", "è”“è¶Šè“ç´…", "æ¡‘è‘šè‰²"]}    //ç´«ç´…
    ];

    let sector = dictionary.find(x => h < x.h) || dictionary[0];
    let v3 = "";
    let v2 = "";

    // æ ¹æ“š L å’Œ S æ±ºå®šé¸ç”¨å“ªå€‹åå­—
    if (l > 80) { v3 = sector.names[0]; v2 = "è¼•ç›ˆé€æ„Ÿ"; }
    else if (s < 35) { v3 = sector.names[1]; v2 = "é«˜ç´šè«è˜­è¿ªæ„Ÿ"; }
    else if (l < 35) { v3 = sector.names[3]; v2 = "æ·±é‚ƒè³ªæ„Ÿ"; }
    else { v3 = sector.names[2]; v2 = "é®®æ˜é£½å’Œ"; }

    // é‡‘å±¬è³ªæ„Ÿä¿®æ­£
    if (h > 40 && h < 70 && s < 40 && l > 40) { v3 = "å†·éœ§å¤éŠ…"; v2 = "é‡‘å±¬ç¤¦ç‰©æ„Ÿ"; }
    if (h > 180 && h < 240 && s < 25 && l > 60) { v3 = "éˆ¦é‡‘éŠ€è—"; v2 = "å†·å†½é‡‘å±¬æ„Ÿ"; }

    return {v3, v2};
}

// è¼”åŠ©å‡½æ•¸
function rgbToHsl(r,g,b){r/=255,g/=255,b/=255;let max=Math.max(r,g,b),min=Math.min(r,g,b),h,s,l=(max+min)/2;if(max==min)h=s=0;else{let d=max-min;s=l>0.5?d/(2-max-min):d/(max+min);switch(max){case r:h=(g-b)/d+(g<b?6:0);break;case g:h=(b-r)/d+2;break;case b:h=(r-g)/d+4;break;}h/=6;}return [h,s,l];}
function hslToHex(h,s,l){l/=100;const a=s*Math.min(l,1-l)/100;const f=n=>{const k=(n+h/30)%12;const color=l-a*Math.max(Math.min(k-3,9-k,1),-1);return Math.round(255*color).toString(16).padStart(2,'0');};return `#${f(0)}${f(8)}${f(4)}`.toUpperCase();}
</script>
</body>
</html>
