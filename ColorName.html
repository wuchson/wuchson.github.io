<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>é¡è‰²åç¨±åˆ¤å®šå™¨</title>
    <style>
        :root { --ink: #0f172a; --gold: #926b4e; --slate: #64748b; --silk: #f8fafc; }
        body { background: var(--silk); font-family: "PingFang TC", "Hiragino Mincho ProN", serif; margin: 0; display: flex; flex-direction: column; align-items: center; color: var(--ink); -webkit-tap-highlight-color: transparent; }
        
        /* é ‚éƒ¨ç›¸æ©Ÿå€ */
        .cam-view { width: 100%; max-width: 450px; aspect-ratio: 1; position: relative; background: #000; overflow: hidden; box-shadow: 0 10px 30px rgba(0,0,0,0.1); }
        #v { width: 100%; height: 100%; object-fit: cover; }
        .aimer { position: absolute; top: 50%; left: 50%; transform: translate(-50%, -50%); width: 18px; height: 18px; border: 2px solid #fff; border-radius: 50%; mix-blend-mode: difference; z-index: 10; pointer-events: none; }
        .aimer::after { content: ''; position: absolute; top: 50%; left: 50%; width: 2px; height: 2px; background: #fff; transform: translate(-50%, -50%); }

        /* å¡ç‰‡å…§å®¹å€ */
        .card { width: 94%; max-width: 450px; background: white; border-radius: 40px 40px 30px 30px; padding: 35px 25px; margin-top: -50px; box-shadow: 0 25px 60px rgba(0,0,0,0.1); z-index: 20; box-sizing: border-box; text-align: center; }
        #preview { width: 110px; height: 110px; border-radius: 50%; margin: 0 auto 20px; border: 8px solid #fff; box-shadow: 0 12px 25px rgba(0,0,0,0.08); transition: background-color 0.3s; }
        
        .name-main { font-size: 34px; font-weight: 900; color: var(--ink); letter-spacing: -1.5px; margin-bottom: 8px; }
        .name-sub { font-size: 14px; color: var(--gold); letter-spacing: 2px; font-weight: 600; text-transform: uppercase; opacity: 0.8; }
        #hex { font-family: monospace; font-size: 13px; color: #cbd5e1; margin-top: 10px; display: block; }

        /* æ»‘æ¡¿æ§åˆ¶ */
        .controls { background: #f1f5f9; padding: 25px; border-radius: 30px; margin-top: 25px; border: 1px solid rgba(0,0,0,0.02); }
        .s-row { margin-bottom: 20px; }
        .s-row:last-child { margin-bottom: 0; }
        .s-info { display: flex; justify-content: space-between; font-size: 12px; color: var(--slate); margin-bottom: 8px; font-weight: 700; }
        input[type=range] { width: 100%; height: 6px; appearance: none; background: #cbd5e1; outline: none; border-radius: 3px; }
        input[type=range]::-webkit-slider-thumb { appearance: none; width: 28px; height: 28px; background: #fff; border: 2px solid var(--gold); border-radius: 50%; cursor: pointer; box-shadow: 0 4px 10px rgba(0,0,0,0.1); }

        /* æŒ‰éˆ•å€ */
        .btn-row { display: flex; gap: 12px; width: 94%; max-width: 450px; margin: 20px 0; }
        button { flex: 1; padding: 20px; border-radius: 20px; border: none; font-weight: 800; cursor: pointer; transition: all 0.2s; font-size: 16px; }
        .btn-p { background: var(--ink); color: white; box-shadow: 0 10px 20px rgba(15,23,42,0.2); }
        .btn-p:active { transform: scale(0.96); }
        .btn-m { background: #fff; color: var(--gold); border: 2.5px solid #e2e8f0; }
        .btn-m.active { background: #efebe9; border-color: var(--gold); }
    </style>
</head>
<body>

<div class="cam-view">
    <video id="v" autoplay playsinline></video>
    <div class="aimer"></div>
</div>

<div class="btn-row">
    <button class="btn-p" onclick="detect()">ğŸ“¸ æ ¸å¿ƒé‘‘å®š</button>
    <button class="btn-m" id="mo-btn" onclick="toggleMorandi()">âœ¨ è«è˜­è¿ªåŒ–</button>
</div>

<div class="card" id="res" style="display:none;">
    <div id="preview"></div>
    <div class="name-main" id="lv3">-</div>
    <div class="name-sub" id="lv2">-</div>
    <span id="hex">#FFFFFF</span>
    
    <div class="controls">
        <div class="s-row">
            <div class="s-info"><span>ç’°å¢ƒæ˜åº¦ (Depth)</span><span id="lv">50%</span></div>
            <input type="range" id="ls" min="0" max="100" oninput="ui()">
        </div>
        <div class="s-row">
            <div class="s-info"><span>è‰²å½©é£½å’Œ (Saturation)</span><span id="sv">50%</span></div>
            <input type="range" id="ss" min="0" max="100" oninput="ui()">
        </div>
    </div>
</div>

<canvas id="c" style="display:none;"></canvas>

<script>
let cH=0, cS=50, cL=50, backupS=50;
const v=document.getElementById('v'), c=document.getElementById('c'), ctx=c.getContext('2d');

navigator.mediaDevices.getUserMedia({video:{facingMode:"environment", width: 1280, height: 720}})
    .then(s=>v.srcObject=s)
    .catch(err=>alert("è«‹å…è¨±ç›¸æ©Ÿå­˜å–ä»¥é€²è¡Œé‘‘å®š"));

function detect() {
    c.width=v.videoWidth; c.height=v.videoHeight;
    ctx.drawImage(v,0,0);
    const p=ctx.getImageData(c.width/2,c.height/2,1,1).data;
    const hsl=rgbToHsl(p[0],p[1],p[2]);
    cH=hsl[0]*360; cS=hsl[1]*100; cL=hsl[2]*100; backupS=cS;
    document.getElementById('ls').value=cL;
    document.getElementById('ss').value=cS;
    document.getElementById('mo-btn').classList.remove('active');
    document.getElementById('mo-btn').innerText = "âœ¨ è«è˜­è¿ªåŒ–";
    ui();
}

function toggleMorandi() {
    const btn = document.getElementById('mo-btn');
    if(!btn.classList.contains('active')){
        backupS=cS; cS=25; 
        btn.classList.add('active');
        btn.innerText = "âª é‚„åŸè‰²å½©";
    } else {
        cS=backupS;
        btn.classList.remove('active');
        btn.innerText = "âœ¨ è«è˜­è¿ªåŒ–";
    }
    document.getElementById('ss').value=cS; ui();
}

function ui() {
    cL=parseInt(document.getElementById('ls').value);
    cS=parseInt(document.getElementById('ss').value);
    const hex=hslToHex(cH,cS,cL);
    document.getElementById('res').style.display='block';
    document.getElementById('preview').style.backgroundColor=hex;
    document.getElementById('hex').innerText=hex;
    document.getElementById('lv').innerText=cL+"%";
    document.getElementById('sv').innerText=cS+"%";

    const n = generateVastName(cH, cS, cL);
    document.getElementById('lv3').innerText = n.v3;
    document.getElementById('lv2').innerText = n.v2;
}

function generateVastName(h, s, l) {
    if (l > 94) return {v3:"é›ªç´¡ç´”ç™½", v2:"High-End Silk White"};
    if (l < 7) return {v3:"æ›œçŸ³æ¥µé»‘", v2:"Obsidian Dark Collection"};

    // åŸºç¤è‰²åº«
    const library = [
        {h: 12,  n:"ç´…",  items:["èƒ­è„‚", "ç·‹ç´…", "å‹ƒè‰®ç¬¬", "è”“è¶Šè“", "å¤•é™½ç´…"]},
        {h: 25,  n:"çŠç‘š",items:["èµ¤æ©˜", "å¤•é™½", "çŠç‘š", "æœ±ç ‚", "æŸ¿å­ç´…"]},
        {h: 42,  n:"è†š/è£¸",items:["ææ¡ƒ", "èœœç²‰", "è£¸ç´—", "å¥¶èŒ¶", "å¡å…¶"]},
        {h: 55,  n:"æ£•/åœŸ",items:["ç„¦ç³–", "èƒ¡æ¡ƒ", "å¯å¯", "ç¥ç€", "æ‘©å¡"]},
        {h: 70,  n:"é»ƒ/é‡‘",items:["é¦™æª³", "å¥¶æ²¹", "æª¸æª¬", "å‘æ—¥è‘µ", "é‡‘ç›"]},
        {h: 110, n:"å«©ç¶ ",items:["è‰¾è‰", "èŠ½ç¶ ", "é’è˜‹æœ", "èŠå§†", "æ©„æ¬–"]},
        {h: 150, n:"æ·±ç¶ ",items:["ç¿¡ç¿ ", "æ£®æ—", "æŠ¹èŒ¶", "å­”é›€ç¶ ", "è–„è·"]},
        {h: 185, n:"é’è—",items:["è’‚èŠ¬å¦®", "é´¨è›‹", "æ¹–æ°´", "é’ç“·", "ç¢§è—"]},
        {h: 215, n:"æ¹›è—",items:["è”šè—", "å‹¿å¿˜è‰", "éœ§éœ¾è—", "æ™®é­¯å£«", "è—é’"]},
        {h: 265, n:"è—ç´«",items:["é›é’", "é³¶å°¾", "è–°è¡£è‰", "è¿·å¹»è—", "ç‰ç’ƒ"]},
        {h: 300, n:"ç´«è‰²",items:["çµ³ç´«", "ä¸é¦™", "æ¡‘è‘š", "è¿·éœ§ç´«", "è‘¡è„"]},
        {h: 340, n:"ç«ç²‰",items:["æ«»èŠ±", "ç«ç‘°", "å°‘å¥³", "ç´…é…’", "èŠ­æ¯”"]}
    ];

    if (s < 10) {
        const greyPrefix = l > 80 ? "æ™¨éœ§" : l > 50 ? "è«è˜­è¿ª" : "æ¿å²©";
        return {v3: greyPrefix + "å²©ç°", v2: "Minimalist Gray Aesthetic"};
    }

    let sector = library.find(x => h < x.h) || library[0];
    
    // èªæ„åˆæˆé‚è¼¯
    let prefix = "";
    let material = "";
    
    if (l > 82) { prefix = "æ¸…é€"; material = "è•¾çµ²ç¹”ç¶²"; }
    else if (l > 65) { prefix = "æŸ”å’Œ"; material = "çµ²çµ¨ç¶¢ç·"; }
    else if (s < 32) { prefix = "è¿·éœ§"; material = "è«è˜­è¿ªæ„Ÿ"; }
    else if (l < 38) { prefix = "å¹½é‚ƒ"; material = "çš®é©è³ªåœ°"; }
    else if (s > 75) { prefix = "æ¥µè‡´"; material = "ç·é¢å…‰æ¾¤"; }
    else { prefix = "ç¶“å…¸"; material = "æˆè¡£é¢æ–™"; }

    let baseIdx = Math.min(Math.floor(l / 20), 4);
    let baseName = sector.items[baseIdx];

    // é‡å°è†šè‰²èˆ‡å…§è¡£çš„å¼·åŒ–ç´°åˆ†
    if (h >= 15 && h <= 50 && s < 48) {
        const skins = ["é€ç²‰è£¸ç´—", "èœœç²‰ææ¡ƒ", "æš–é™½å¥¶èŒ¶", "æ³•å¼å¯å¯", "å†·èƒæ­è•¾"];
        return {v3: skins[Math.floor(l/20)] || "æ¥µè‡´è£¸è†š", v2: "Lingerie Skin Collection"};
    }

    return { v3: prefix + baseName + (s < 28 ? "ç°" : ""), v2: `${material} Â· ${sector.n}è‰²ç³»` };
}

function rgbToHsl(r,g,b){r/=255,g/=255,b/=255;let max=Math.max(r,g,b),min=Math.min(r,g,b),h,s,l=(max+min)/2;if(max==min)h=s=0;else{let d=max-min;s=l>0.5?d/(2-max-min):d/(max+min);switch(max){case r:h=(g-b)/d+(g<b?6:0);break;case g:h=(b-r)/d+2;break;case b:h=(r-g)/d+4;break;}h/=6;}return [h,s,l];}
function hslToHex(h,s,l){l/=100;const a=s*Math.min(l,1-l)/100;const f=n=>{const k=(n+h/30)%12;const color=l-a*Math.max(Math.min(k-3,9-k,1),-1);return Math.round(255*color).toString(16).padStart(2,'0');};return `#${f(0)}${f(8)}${f(4)}`.toUpperCase();}
</script>
</body>
</html>
