<!DOCTYPE html>
<html lang="zh-Hant">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>å€‰å„²å®šä½åŠ©æ‰‹</title>
    <script src="https://cdn.sheetjs.com/xlsx-latest/package/dist/xlsx.full.min.js"></script>
    <style>
        :root {
            --primary: #4361ee;
            --accent: #4cc9f0;
            --danger: #f72585;
            --warning: #ffb703;
            --bg: #f8f9fc;
            --card: #ffffff;
            --text: #2b2d42;
        }

        * { box-sizing: border-box; }
        body {
            font-family: 'PingFang TC', 'Microsoft JhengHei', sans-serif;
            background-color: var(--bg);
            color: var(--text);
            margin: 0; padding: 0; overflow-x: hidden;
        }

        header {
            width: 100%;
            background: linear-gradient(135deg, var(--primary), var(--accent));
            color: white;
            padding: 20px;
            text-align: center;
        }

        .container {
            width: 100%; padding: 15px; max-width: 600px; margin: 0 auto;
        }

        .input-card {
            background: var(--card);
            padding: 20px;
            border-radius: 12px;
            box-shadow: 0 4px 12px rgba(0,0,0,0.08);
            margin-top: -30px;
            border: 2px solid transparent;
            transition: 0.3s;
        }

        /* ç·¨è¼¯æ¨¡å¼æ™‚çš„é‚Šæ¡†é¡è‰² */
        .input-card.edit-mode { border-color: var(--warning); background: #fffdf5; }

        .grid-row {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 12px;
            margin-bottom: 12px;
        }

        @media (max-width: 480px) {
            .grid-row { grid-template-columns: 1fr; }
        }

        .input-group { display: flex; flex-direction: column; }
        .input-group label { font-size: 13px; font-weight: bold; color: #8d99ae; margin-bottom: 4px; }
        .input-group input {
            padding: 12px; border: 2px solid #edf2f4; border-radius: 8px; font-size: 16px; width: 100%;
        }

        .btn-main {
            width: 100%; padding: 14px; background: var(--primary); color: white; border: none;
            border-radius: 8px; font-size: 16px; font-weight: bold; cursor: pointer; margin-top: 10px;
        }
        
        .btn-main.update { background: var(--warning); color: #000; }

        .tool-bar {
            margin-top: 15px;
            display: flex;
            gap: 10px;
            justify-content: center;
        }
        .btn-tool {
            flex: 1; padding: 10px; font-size: 13px; border-radius: 8px; border: 1px solid #d1d9e6;
            background: #fff; cursor: pointer; color: #4a5568; font-weight: 600;
        }

        .search-bar { margin: 25px 0 15px 0; }
        .search-bar input {
            width: 100%; padding: 15px; border-radius: 10px; border: 2px solid var(--primary); font-size: 16px;
        }

        .item-card {
            background: white; border-radius: 12px; padding: 15px; margin-bottom: 12px;
            border-left: 6px solid var(--primary); box-shadow: 0 2px 8px rgba(0,0,0,0.05);
            display: flex; justify-content: space-between; align-items: center;
        }

        .item-info { flex: 1; padding-right: 10px; }
        .item-sku { font-size: 18px; font-weight: 800; color: var(--primary); }
        .item-loc {
            background: #fff0f3; color: var(--danger); display: inline-block;
            padding: 4px 8px; border-radius: 4px; font-weight: bold; margin-top: 5px;
        }

        .action-btns { display: flex; flex-direction: column; gap: 8px; }
        .btn-edit { background: #e9ecef; color: #495057; border: none; padding: 6px 12px; border-radius: 6px; cursor: pointer; font-size: 12px; }
        .btn-del { background: #fff5f5; color: var(--danger); border: none; padding: 6px 12px; border-radius: 6px; cursor: pointer; font-size: 12px; }

        #fileImport { display: none; }
    </style>
</head>
<body>

<header>
    <h2 style="margin:0;">ğŸ“¦ å€‰å„²å¿«æŸ¥åŠ©æ‰‹ Pro</h2>
</header>

<div class="container">
    <div class="input-card" id="inputCard">
        <input type="hidden" id="editId"> <div class="grid-row">
            <div class="input-group">
                <label>å» å•†</label>
                <input type="text" id="vendor" placeholder="ä¾‹å¦‚: å» å•†A">
            </div>
            <div class="input-group">
                <label>å‹è™Ÿ (SKU)</label>
                <input type="text" id="sku" placeholder="ä¾‹å¦‚: ABC-123">
            </div>
        </div>
        <div class="grid-row">
            <div class="input-group">
                <label>å“å</label>
                <input type="text" id="itemName" placeholder="ä¾‹å¦‚: ç‰›ä»”è£™">
            </div>
            <div class="input-group">
                <label>å„²ä½ä½ç½®(ä¾‹å¦‚: Aæ£Ÿ-1F-Bå€-B2Fæ¶ä¸Š-èªªæ˜)</label>
                <input type="text" id="location" placeholder="A-1F-B-B2F-èªªæ˜">
            </div>
        </div>
        <button id="submitBtn" class="btn-main" onclick="handleSave()">ä¿å­˜å–®ç­†è³‡æ–™</button>
        
        <div class="tool-bar">
            <button class="btn-tool" onclick="document.getElementById('fileImport').click()">ğŸ“¥ åŒ¯å…¥ Excel</button>
            <button class="btn-tool" onclick="exportToExcel()">ğŸ“¤ åŒ¯å‡º Excel</button>
        </div>
        <input type="file" id="fileImport" accept=".xlsx, .xls, .csv" onchange="importFromExcel(event)">
    </div>

    <div class="search-bar">
        <input type="text" id="searchInput" placeholder="ğŸ” å¿«é€Ÿæœå°‹..." onkeyup="render()">
    </div>

    <div id="list"></div>
</div>

<script>
    let db = JSON.parse(localStorage.getItem('stockDB')) || [];
    let isEditing = false;

    // ä¿å­˜æˆ–æ›´æ–°è³‡æ–™
    function handleSave() {
        const vendor = document.getElementById('vendor').value;
        const sku = document.getElementById('sku').value;
        const name = document.getElementById('itemName').value;
        const loc = document.getElementById('location').value;
        const editId = document.getElementById('editId').value;

        if(!sku || !loc) return alert("å‹è™Ÿèˆ‡ä½ç½®å¿…å¡«ï¼");

        if (isEditing) {
            // æ›´æ–°æ¨¡å¼
            const index = db.findIndex(i => i.id == editId);
            db[index] = { ...db[index], vendor, sku, name, loc };
            exitEditMode();
        } else {
            // æ–°å¢æ¨¡å¼
            db.unshift({ id: Date.now(), vendor, sku, name, loc });
        }

        saveAndRender();
        clearInputs();
    }

    // é€²å…¥ç·¨è¼¯æ¨¡å¼
    function startEdit(id) {
        const item = db.find(i => i.id == id);
        if (!item) return;

        isEditing = true;
        document.getElementById('editId').value = item.id;
        document.getElementById('vendor').value = item.vendor;
        document.getElementById('sku').value = item.sku;
        document.getElementById('itemName').value = item.name;
        document.getElementById('location').value = item.loc;

        // åˆ‡æ› UI ç‹€æ…‹
        const btn = document.getElementById('submitBtn');
        btn.innerText = "ğŸ’¾ æ›´æ–°æ­¤è³‡æ–™ä½ç½®";
        btn.classList.add('update');
        document.getElementById('inputCard').classList.add('edit-mode');
        
        // è‡ªå‹•æ²å‹•åˆ°é ‚éƒ¨
        window.scrollTo({ top: 0, behavior: 'smooth' });
    }

    function exitEditMode() {
        isEditing = false;
        const btn = document.getElementById('submitBtn');
        btn.innerText = "ä¿å­˜å–®ç­†è³‡æ–™";
        btn.classList.remove('update');
        document.getElementById('inputCard').classList.remove('edit-mode');
        document.getElementById('editId').value = "";
    }

    function clearInputs() {
        document.querySelectorAll('.input-group input').forEach(i => i.value = '');
    }

    // --- ä»¥ä¸‹ç‚ºåŸæœ¬çš„ Excel åŒ¯å…¥/åŒ¯å‡ºèˆ‡åˆªé™¤åŠŸèƒ½ ---

    function importFromExcel(event) {
        const file = event.target.files[0];
        if(!file) return;
        const reader = new FileReader();
        reader.onload = function(e) {
            const data = new Uint8Array(e.target.result);
            const workbook = XLSX.read(data, {type: 'array'});
            const sheet = workbook.Sheets[workbook.SheetNames[0]];
            const json = XLSX.utils.sheet_to_json(sheet);
            const newItems = json.map(row => ({
                id: Date.now() + Math.random(),
                vendor: row['å» å•†'] || '',
                sku: String(row['å‹è™Ÿ'] || row['SKU'] || ''),
                name: row['å“å'] || '',
                loc: String(row['å„²ä½'] || row['ä½ç½®'] || '')
            })).filter(i => i.sku && i.loc);
            db = [...newItems, ...db];
            saveAndRender();
        };
        reader.readAsArrayBuffer(file);
    }

    function exportToExcel() {
        if (db.length === 0) return alert("æ²’æœ‰è³‡æ–™");
        const exportData = db.map(i => ({ "å» å•†": i.vendor, "å‹è™Ÿ": i.sku, "å“å": i.name, "å„²ä½": i.loc }));
        const worksheet = XLSX.utils.json_to_sheet(exportData);
        const workbook = XLSX.utils.book_new();
        XLSX.utils.book_append_sheet(workbook, worksheet, "åº«å­˜");
        XLSX.writeFile(workbook, `å€‰å„²-${new Date().toISOString().split('T')[0]}.xlsx`);
    }

    function deleteItem(id) {
        if(confirm('ç¢ºå®šè¦åˆªé™¤å—ï¼Ÿ')) {
            db = db.filter(i => i.id !== id);
            saveAndRender();
        }
    }

    function saveAndRender() {
        localStorage.setItem('stockDB', JSON.stringify(db));
        render();
    }

    function render() {
        const query = document.getElementById('searchInput').value.toLowerCase();
        const listDiv = document.getElementById('list');
        listDiv.innerHTML = '';
        db.filter(i => 
            String(i.sku).toLowerCase().includes(query) || 
            String(i.vendor).toLowerCase().includes(query) ||
            String(i.loc).toLowerCase().includes(query)
        ).forEach(i => {
            listDiv.innerHTML += `
                <div class="item-card">
                    <div class="item-info">
                        <div class="item-sku">${i.sku}</div>
                        <div style="font-size:13px; color:#666;">${i.vendor} | ${i.name}</div>
                        <div class="item-loc">ğŸ“ ${i.loc}</div>
                    </div>
                    <div class="action-btns">
                        <button class="btn-edit" onclick="startEdit(${i.id})">ä¿®æ”¹</button>
                        <button class="btn-del" onclick="deleteItem(${i.id})">åˆªé™¤</button>
                    </div>
                </div>
            `;
        });
    }
    render();
</script>

</body>
</html>
