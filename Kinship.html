<!DOCTYPE html>
<html lang="zh-Hant">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>親戚關係助手 - 八親等精確版</title>
    <style>
        :root { --male: #6c5ce7; --female: #e84393; --bg: #f8f9fd; }
        body { font-family: -apple-system, "PingFang TC", sans-serif; background: var(--bg); transition: 0.5s; padding-bottom: 50px; }
        body.female-mode { background: #fff5f8; }
        .screen { 
            background: white; margin: 20px; border-radius: 30px; padding: 40px 20px; 
            box-shadow: 0 10px 40px rgba(0,0,0,0.05); text-align: center;
            min-height: 240px; display: flex; flex-direction: column; justify-content: center;
        }
        .path { font-size: 0.9rem; color: #b2bec3; margin-bottom: 10px; height: 1.2rem; }
        .ans { font-size: 2.5rem; font-weight: 900; color: var(--male); transition: 0.3s; line-height: 1.2; }
        .female-mode .ans { color: var(--female); }
        .tags { margin-top: 15px; display: flex; justify-content: center; gap: 8px; flex-wrap: wrap; }
        .tag { padding: 5px 12px; border-radius: 12px; background: #eeeafb; color: var(--male); font-weight: bold; font-size: 0.75rem; }
        .female-mode .tag { background: #fff0f6; color: var(--female); }
        .gender-box { display: flex; justify-content: center; gap: 15px; margin-bottom: 20px; }
        .g-btn { border: none; background: #eeeafb; padding: 10px 30px; border-radius: 20px; font-weight: bold; color: #a29bfe; cursor: pointer; transition: 0.3s; }
        .g-btn.active { background: var(--male); color: white; }
        .female-mode .g-btn.active { background: var(--female); }
        .keypad-container { padding: 0 20px; max-width: 500px; margin: 0 auto; }
        .keypad { display: grid; grid-template-columns: repeat(4, 1fr); gap: 10px; }
        .key { aspect-ratio: 1.1; border: none; background: white; border-radius: 18px; font-size: 1.1rem; font-weight: bold; box-shadow: 0 4px 10px rgba(0,0,0,0.03); cursor: pointer; }
        .key:active { transform: scale(0.9); background: #f1f0ff; }
        .key.op { color: var(--male); background: #f8f7ff; }
        .female-mode .key.op { color: var(--female); background: #fff0f6; }
    </style>
</head>
<body>

<header style="text-align:center; padding: 20px 0;">
    <h1 style="font-size:1.5rem;">親戚關係助手 Pro</h1>
    <p style="font-size:0.8rem; color:#a29bfe;">八親等 · 法律精確版</p>
</header>

<div class="screen">
    <div id="path" class="path">請開始輸入組合...</div>
    <div id="ans" class="ans">自己</div>
    <div class="tags" id="tags"></div>
</div>

<div class="gender-box">
    <button id="mBtn" class="g-btn active" onclick="setGender('male')">男</button>
    <button id="fBtn" class="g-btn" onclick="setGender('female')">女</button>
</div>

<div class="keypad-container">
    <div class="keypad">
        <button class="key op" onclick="add('父')">父</button>
        <button class="key op" onclick="add('母')">母</button>
        <button class="key" onclick="back()">退格</button>
        <button class="key" style="color:#ff7675" onclick="reset()">歸零</button>
        <button class="key" onclick="add('兄')">兄</button>
        <button class="key" onclick="add('弟')">弟</button>
        <button class="key" onclick="add('姐')">姐</button>
        <button class="key" onclick="add('妹')">妹</button>
        <button class="key op" onclick="add('夫')">夫</button>
        <button class="key op" onclick="add('妻')">妻</button>
        <button class="key op" onclick="add('子')">子</button>
        <button class="key op" onclick="add('女')">女</button>
    </div>
</div>

<script>
    let gender = 'male';
    let stack = [];

    // 精確字典
    const exactDict = {
        "父": "父親", "母": "母親", "子": "兒子", "女": "女兒",
        "父,父": "爺爺", "父,母": "奶奶", "母,父": "外公", "母,母": "外婆",
        "父,兄": "伯父", "父,弟": "叔父", "父,姐": "姑姑", "父,妹": "姑姑",
        "母,兄": "舅舅", "母,弟": "舅舅", "母,姐": "姨媽", "母,妹": "姨媽",
        "兄,子": "姪子", "姐,子": "外甥", "弟,子": "姪子", "妹,子": "外甥",
        "male_妻": "妻子", "female_夫": "丈夫"
    };

    const upNames = ["父親", "爺爺", "曾祖父", "高祖父", "天祖父", "烈祖父", "太祖父", "遠祖父"];
    const downNames = ["兒子", "孫子", "曾孫", "玄孫", "來孫", "晜孫", "仍孫", "雲孫"];

    function setGender(g) {
        gender = g;
        document.body.classList.toggle('female-mode', g === 'female');
        document.getElementById('mBtn').classList.toggle('active', g === 'male');
        document.getElementById('fBtn').classList.toggle('active', g === 'female');
        update();
    }

    function add(r) {
        if (stack.length >= 12) return;
        stack.push(r);
        update();
    }

    function back() { stack.pop(); update(); }
    function reset() { stack = []; update(); }

    function update() {
        const pathEl = document.getElementById('path');
        const ansEl = document.getElementById('ans');
        const tagsEl = document.getElementById('tags');
        
        if (stack.length === 0) {
            pathEl.innerText = "請開始輸入...";
            ansEl.innerText = gender === 'male' ? "自己 (男)" : "自己 (女)";
            tagsEl.innerHTML = "";
            return;
        }

        pathEl.innerText = "我的 " + stack.join(' 的 ');
        const key = stack.join(',');
        
        let name = exactDict[gender + "_" + key] || exactDict[key];
        let up = 0, down = 0, isSide = false;
        
        stack.forEach(r => {
            if (['父', '母'].includes(r)) up++;
            else if (['子', '女'].includes(r)) down++;
            else if (['兄', '弟', '姐', '妹'].includes(r)) { up++; down++; isSide = true; }
        });

        if (!name) {
            if (up > 0 && down === 0) name = upNames[up-1] || "遠祖";
            else if (down > 0 && up === 0) name = downNames[down-1] || "遠孫";
            else name = isSide ? (up + down) + "親等旁系" : "親戚關係";
        }

        ansEl.innerText = name;
        ansEl.style.fontSize = name.length > 6 ? "1.8rem" : "2.5rem";
        
        tagsEl.innerHTML = `<span class="tag">${up + down} 親等</span>`;
        if (isSide) tagsEl.innerHTML += `<span class="tag">旁系血親</span>`;
        else if (up + down > 0) tagsEl.innerHTML += `<span class="tag">直系血親</span>`;
    }
</script>
</body>
</html>
