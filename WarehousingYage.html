<!DOCTYPE html>
<html lang="zh-Hant">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>å€‰å„²é›²ç«¯åŠ©æ‰‹</title>
    <style>
        :root { --primary: #4361ee; --accent: #4cc9f0; --danger: #f72585; --warning: #ffb703; --bg: #f8f9fc; --card: #ffffff; --text: #2b2d42; }
        * { box-sizing: border-box; font-family: sans-serif; }
        body { background-color: var(--bg); color: var(--text); margin: 0; padding: 0; }
        header { background: linear-gradient(135deg, var(--primary), var(--accent)); color: white; padding: 20px; text-align: center; }
        .container { width: 100%; padding: 15px; max-width: 600px; margin: 0 auto; }
        .input-card { background: var(--card); padding: 20px; border-radius: 12px; box-shadow: 0 4px 12px rgba(0,0,0,0.08); margin-top: -30px; border: 2px solid transparent; }
        .input-card.edit-mode { border-color: var(--warning); background: #fffdf5; }
        .grid-row { display: grid; grid-template-columns: 1fr 1fr; gap: 12px; margin-bottom: 12px; }
        @media (max-width: 480px) { .grid-row { grid-template-columns: 1fr; } }
        .input-group label { font-size: 12px; font-weight: bold; color: #8d99ae; }
        .input-group input { padding: 12px; border: 2px solid #edf2f4; border-radius: 8px; font-size: 16px; width: 100%; margin-top: 4px; }
        .btn-main { width: 100%; padding: 14px; background: var(--primary); color: white; border: none; border-radius: 8px; font-size: 16px; font-weight: bold; cursor: pointer; margin-top: 10px; }
        .btn-main.update { background: var(--warning); color: #000; }
        .btn-main:disabled { background: #ccc; cursor: not-allowed; }
        .search-bar { margin: 25px 0 15px 0; }
        .search-bar input { width: 100%; padding: 15px; border-radius: 10px; border: 2px solid var(--primary); font-size: 16px; }
        .item-card { background: white; border-radius: 12px; padding: 15px; margin-bottom: 12px; border-left: 6px solid var(--primary); box-shadow: 0 2px 8px rgba(0,0,0,0.05); display: flex; justify-content: space-between; align-items: center; }
        .item-sku { font-size: 18px; font-weight: 800; color: var(--primary); }
        .item-loc { background: #fff0f3; color: var(--danger); display: inline-block; padding: 4px 8px; border-radius: 4px; font-weight: bold; margin-top: 5px; font-size: 14px; }
        .action-btns { display: flex; flex-direction: column; gap: 8px; }
        .btn-edit { background: #e9ecef; border: none; padding: 6px 12px; border-radius: 6px; cursor: pointer; }
        .btn-del { background: #fff5f5; color: var(--danger); border: none; padding: 6px 12px; border-radius: 6px; cursor: pointer; }
        #loadingOverlay { text-align: center; padding: 20px; color: #666; }
    </style>
</head>
<body>

<header><h2>ğŸ“¦ å€‰å„²å®šä½åŠ©æ‰‹-é›²ç«¯ç‰ˆ</h2></header>

<div class="container">
    <div class="input-card" id="inputCard">
        <input type="hidden" id="editId">
        <div class="grid-row">
            <div class="input-group"><label>å» å•†</label><input type="text" id="vendor"></div>
            <div class="input-group"><label>å‹è™Ÿ (A1234)</label><input type="text" id="sku"></div>
        </div>
        <div class="grid-row">
            <div class="input-group"><label>å“å(å…§è¡£/å…§è¤²)</label><input type="text" id="itemName"></div>
            <div class="input-group"><label>å„²ä½ä½ç½®(ä¾‹å¦‚: Aæ£Ÿ-1F-Bå€-B2Fæ¶ä¸Š-èªªæ˜)</label><input type="text" id="location"></div>
        </div>
        <button id="submitBtn" class="btn-main" onclick="handleSave()">ä¿å­˜è³‡æ–™</button>
    </div>

    <div class="search-bar">
        <input type="text" id="searchInput" placeholder="ğŸ” å¿«é€Ÿæœå°‹å» å•†ã€å‹è™Ÿæˆ–å„²ä½..." onkeyup="render()">
    </div>

    <div id="loadingOverlay">æ­£åœ¨è®€å–é›²ç«¯è³‡æ–™...</div>
    <div id="list"></div>
</div>

<script>
    // âš ï¸ è«‹åœ¨æ­¤è™•å¡«å…¥ä½ éƒ¨ç½²å¥½çš„ Google Apps Script URL
    const API_URL = "https://script.google.com/macros/s/AKfycbyvVtwur7SG6FQxtp_pW7DIJiOn0hkU85ic23g7HGPqixm7W4vKygC1SeYjF5-EX-8L/exec";

    let db = [];

    // åˆå§‹åŒ–è®€å–
    async function loadData() {
        document.getElementById('loadingOverlay').style.display = 'block';
        try {
            const response = await fetch(API_URL, {
                method: 'POST',
                body: JSON.stringify({ action: 'read' })
            });
            db = await response.json();
            render();
        } catch (e) {
            alert('é€£ç·šå¤±æ•—ï¼Œè«‹æª¢æŸ¥ API URL');
        }
        document.getElementById('loadingOverlay').style.display = 'none';
    }

    // ä¿å­˜èˆ‡æ›´æ–°
    async function handleSave() {
        const submitBtn = document.getElementById('submitBtn');
        const item = {
            id: document.getElementById('editId').value,
            vendor: document.getElementById('vendor').value,
            sku: document.getElementById('sku').value,
            name: document.getElementById('itemName').value,
            loc: document.getElementById('location').value
        };

        if(!item.sku || !item.loc) return alert("å‹è™Ÿèˆ‡ä½ç½®å¿…å¡«ï¼");

        submitBtn.disabled = true;
        submitBtn.innerText = "åŒæ­¥ä¸­...";

        await fetch(API_URL, {
            method: 'POST',
            body: JSON.stringify({ action: 'save', data: item })
        });

        clearInputs();
        resetMode();
        await loadData();
        submitBtn.disabled = false;
        submitBtn.innerText = "ä¿å­˜è³‡æ–™";
    }

    // åˆªé™¤è³‡æ–™
    async function deleteItem(id) {
        if(!confirm('ç¢ºå®šè¦åˆªé™¤å—ï¼Ÿ')) return;
        await fetch(API_URL, {
            method: 'POST',
            body: JSON.stringify({ action: 'delete', id: id })
        });
        await loadData();
    }

    // é€²å…¥ç·¨è¼¯æ¨¡å¼
    function startEdit(id) {
        const item = db.find(i => i.id == id);
        if (!item) return;

        document.getElementById('editId').value = item.id;
        document.getElementById('vendor').value = item.vendor;
        document.getElementById('sku').value = item.sku;
        document.getElementById('itemName').value = item.name;
        document.getElementById('location').value = item.loc;

        document.getElementById('submitBtn').innerText = "ğŸ’¾ æ›´æ–°æ­¤ä½ç½®";
        document.getElementById('submitBtn').classList.add('update');
        document.getElementById('inputCard').classList.add('edit-mode');
        window.scrollTo({ top: 0, behavior: 'smooth' });
    }

    function resetMode() {
        document.getElementById('editId').value = "";
        document.getElementById('submitBtn').innerText = "ä¿å­˜è³‡æ–™";
        document.getElementById('submitBtn').classList.remove('update');
        document.getElementById('inputCard').classList.remove('edit-mode');
    }

    function clearInputs() {
        document.querySelectorAll('.input-group input').forEach(i => i.value = '');
    }

    function render() {
        const query = document.getElementById('searchInput').value.toLowerCase();
        const listDiv = document.getElementById('list');
        listDiv.innerHTML = '';
        
        db.filter(i => 
            String(i.sku).toLowerCase().includes(query) || 
            String(i.vendor).toLowerCase().includes(query) ||
            String(i.loc).toLowerCase().includes(query)
        ).forEach(i => {
            listDiv.innerHTML += `
                <div class="item-card">
                    <div class="item-info">
                        <div class="item-sku">${i.sku}</div>
                        <div style="font-size:13px; color:#666;">${i.vendor} | ${i.name}</div>
                        <div class="item-loc">ğŸ“ ${i.loc}</div>
                    </div>
                    <div class="action-btns">
                        <button class="btn-edit" onclick="startEdit(${i.id})">ä¿®æ”¹</button>
                        <button class="btn-del" onclick="deleteItem(${i.id})">åˆªé™¤</button>
                    </div>
                </div>
            `;
        });
    }

    window.onload = loadData;
</script>
</body>
</html>
