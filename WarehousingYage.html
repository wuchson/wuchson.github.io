<!DOCTYPE html>
<html lang="zh-Hant">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>å€‰å„²å®šä½åŠ©æ‰‹-é›²ç«¯ç‰ˆ</title>
    <style>
        :root { --primary: #4361ee; --accent: #4cc9f0; --danger: #f72585; --warning: #ffb703; --bg: #f8f9fc; --card: #ffffff; --text: #2b2d42; }
        * { box-sizing: border-box; }
        body { font-family: sans-serif; background-color: var(--bg); color: var(--text); margin: 0; padding: 0; }
        header { background: linear-gradient(135deg, var(--primary), var(--accent)); color: white; padding: 20px; text-align: center; }
        .container { width: 100%; padding: 15px; max-width: 600px; margin: 0 auto; }
        
        .input-card { background: var(--card); padding: 20px; border-radius: 12px; box-shadow: 0 4px 12px rgba(0,0,0,0.08); margin-top: -30px; border: 2px solid transparent; }
        .input-card.edit-mode { border-color: var(--warning); background: #fffdf5; }
        
        .grid-row { display: grid; grid-template-columns: 1fr 1fr; gap: 12px; margin-bottom: 12px; }
        @media (max-width: 480px) { .grid-row { grid-template-columns: 1fr; } }
        
        .input-group label { font-size: 13px; font-weight: bold; color: #8d99ae; }
        .input-group input { padding: 12px; border: 2px solid #edf2f4; border-radius: 8px; font-size: 16px; width: 100%; margin-top: 4px; }
        
        .btn-main { width: 100%; padding: 14px; background: var(--primary); color: white; border: none; border-radius: 8px; font-size: 16px; font-weight: bold; cursor: pointer; margin-top: 10px; transition: 0.3s; }
        .btn-main.update { background: var(--warning); color: #000; }
        .btn-main:disabled { background: #ccc; opacity: 0.7; }

        .admin-bar { background: #eaedf7; padding: 10px; border-radius: 8px; margin-bottom: 15px; display: flex; align-items: center; justify-content: space-between; }
        .admin-bar input { padding: 8px; border: 1px solid #ccd; border-radius: 4px; width: 120px; }

        .search-bar { margin: 25px 0 15px 0; }
        .search-bar input { width: 100%; padding: 15px; border-radius: 10px; border: 2px solid var(--primary); font-size: 16px; }

        .item-card { background: white; border-radius: 12px; padding: 15px; margin-bottom: 12px; border-left: 6px solid var(--primary); box-shadow: 0 2px 8px rgba(0,0,0,0.05); display: flex; justify-content: space-between; align-items: center; }
        .item-sku { font-size: 18px; font-weight: 800; color: var(--primary); }
        .item-loc { background: #fff0f3; color: var(--danger); display: inline-block; padding: 4px 8px; border-radius: 4px; font-weight: bold; margin-top: 5px; font-size: 14px; }
        
        .action-btns { display: none; flex-direction: column; gap: 8px; }
        .btn-edit { background: #e9ecef; border: none; padding: 6px 12px; border-radius: 6px; cursor: pointer; font-size: 12px; }
        .btn-del { background: #fff5f5; color: var(--danger); border: none; padding: 6px 12px; border-radius: 6px; cursor: pointer; font-size: 12px; }
        
        #loading { text-align: center; color: #888; padding: 20px; }
    </style>
</head>
<body>

<header><h2 style="margin:0;">ğŸ“¦ å€‰å„²å®šä½åŠ©æ‰‹</h2></header>

<div class="container">
    <div class="admin-bar">
        <span style="font-size: 13px; color: #4361ee; font-weight: bold;">ğŸ”‘ ç®¡ç†å“¡æ¨¡å¼</span>
        <input type="password" id="adminPwd" placeholder="è¼¸å…¥å¯†ç¢¼è§£é–ä¿®æ”¹" oninput="toggleAdminMode()">
    </div>

    <div class="input-card" id="inputCard">
        <input type="hidden" id="editId">
        <div class="grid-row">
            <div class="input-group"><label>å» å•†</label><input type="text" id="vendor"></div>
            <div class="input-group"><label>å‹è™Ÿ (A1234)</label><input type="text" id="sku"></div>
        </div>
        <div class="grid-row">
            <div class="input-group"><label>å“å(å…§è¡£/å…§è¤²)</label><input type="text" id="itemName"></div>
            <div class="input-group"><label>å„²ä½ä½ç½®(ä¾‹å¦‚: Aæ£Ÿ-1F-Bå€-B2Fæ¶ä¸Š-èªªæ˜)</label><input type="text" id="location"></div>
        </div>
        <button id="submitBtn" class="btn-main" onclick="handleSave()">ä¿å­˜å–®ç­†è³‡æ–™</button>
    </div>

    <div class="search-bar">
        <input type="text" id="searchInput" placeholder="ğŸ” å¿«é€Ÿæœå°‹..." onkeyup="render()">
    </div>

    <div id="loading">è®€å–é›²ç«¯è³‡æ–™ä¸­...</div>
    <div id="list"></div>
</div>

<script>
    // --- âš ï¸ é‡è¦ï¼šè«‹åœ¨æ­¤è™•å¡«å…¥ä½ çš„ Google Apps Script éƒ¨ç½² URL ---
    const API_URL = "https://script.google.com/macros/s/AKfycbyvVtwur7SG6FQxtp_pW7DIJiOn0hkU85ic23g7HGPqixm7W4vKygC1SeYjF5-EX-8L/exec";

    let db = [];

    // åˆå§‹è¼‰å…¥
    async function loadData() {
        document.getElementById('loading').style.display = 'block';
        try {
            const resp = await fetch(API_URL, {
                method: 'POST',
                body: JSON.stringify({ action: 'read' })
            });
            db = await resp.json();
            render();
        } catch (e) {
            alert("è®€å–å¤±æ•—ï¼Œè«‹æª¢æŸ¥ç¶²è·¯æˆ– API è¨­å®š");
        }
        document.getElementById('loading').style.display = 'none';
    }

    // æ¬Šé™åˆ‡æ›
    function toggleAdminMode() {
        const pwd = document.getElementById('adminPwd').value;
        const btns = document.querySelectorAll('.action-btns');
        // å¦‚æœè¼¸å…¥æ¡†æœ‰å…§å®¹ï¼Œå˜—è©¦é¡¯ç¤ºç·¨è¼¯æŒ‰éˆ• (å¯¦éš›æ¬Šé™ä»ä»¥å¾Œç«¯é©—è­‰ç‚ºæº–)
        btns.forEach(b => b.style.display = pwd.length > 0 ? 'flex' : 'none');
    }

    // ä¿å­˜èˆ‡æ›´æ–°
    async function handleSave() {
        const btn = document.getElementById('submitBtn');
        const item = {
            id: document.getElementById('editId').value,
            vendor: document.getElementById('vendor').value,
            sku: document.getElementById('sku').value,
            name: document.getElementById('itemName').value,
            loc: document.getElementById('location').value
        };

        if(!item.sku || !item.loc) return alert("å‹è™Ÿèˆ‡ä½ç½®å¿…å¡«ï¼");

        btn.disabled = true;
        btn.innerText = "é€£ç·šä¸­...";

        const resp = await fetch(API_URL, {
            method: 'POST',
            body: JSON.stringify({
                action: 'save',
                data: item,
                password: document.getElementById('adminPwd').value
            })
        });

        const result = await resp.text();
        if(result.includes("Error")) {
            alert(result);
        } else {
            clearInputs();
            exitEditMode();
            await loadData();
        }
        btn.disabled = false;
        btn.innerText = "ä¿å­˜å–®ç­†è³‡æ–™";
    }

    // é€²å…¥ç·¨è¼¯
    function startEdit(id) {
        const item = db.find(i => i.id == id);
        if(!item) return;
        document.getElementById('editId').value = item.id;
        document.getElementById('vendor').value = item.vendor;
        document.getElementById('sku').value = item.sku;
        document.getElementById('itemName').value = item.name;
        document.getElementById('location').value = item.loc;

        const btn = document.getElementById('submitBtn');
        btn.innerText = "ğŸ’¾ æ›´æ–°æ­¤è³‡æ–™ä½ç½®";
        btn.classList.add('update');
        document.getElementById('inputCard').classList.add('edit-mode');
        window.scrollTo({ top: 0, behavior: 'smooth' });
    }

    // åˆªé™¤
    async function deleteItem(id) {
        if(!confirm('ç¢ºå®šè¦åˆªé™¤å—ï¼Ÿ')) return;
        const resp = await fetch(API_URL, {
            method: 'POST',
            body: JSON.stringify({
                action: 'delete',
                id: id,
                password: document.getElementById('adminPwd').value
            })
        });
        const result = await resp.text();
        if(result.includes("Error")) alert(result);
        await loadData();
    }

    function exitEditMode() {
        document.getElementById('editId').value = "";
        document.getElementById('submitBtn').classList.remove('update');
        document.getElementById('inputCard').classList.remove('edit-mode');
    }

    function clearInputs() {
        document.querySelectorAll('.input-group input').forEach(i => i.value = '');
    }

    function render() {
        const query = document.getElementById('searchInput').value.toLowerCase();
        const listDiv = document.getElementById('list');
        const pwdEntered = document.getElementById('adminPwd').value.length > 0;
        listDiv.innerHTML = '';

        db.filter(i => 
            String(i.sku).toLowerCase().includes(query) || 
            String(i.vendor).toLowerCase().includes(query) ||
            String(i.loc).toLowerCase().includes(query)
        ).forEach(i => {
            listDiv.innerHTML += `
                <div class="item-card">
                    <div class="item-info">
                        <div class="item-sku">${i.sku}</div>
                        <div style="font-size:13px; color:#666;">${i.vendor} | ${i.name}</div>
                        <div class="item-loc">ğŸ“ ${i.loc}</div>
                    </div>
                    <div class="action-btns" style="display: ${pwdEntered ? 'flex' : 'none'}">
                        <button class="btn-edit" onclick="startEdit('${i.id}')">ä¿®æ”¹</button>
                        <button class="btn-del" onclick="deleteItem('${i.id}')">åˆªé™¤</button>
                    </div>
                </div>
            `;
        });
    }

    window.onload = loadData;
</script>
</body>
</html>
