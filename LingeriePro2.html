<div class="card admin-only">
    <h3>1. åŸºç¤è¨­å®š</h3>
    <div class="row-inputs">
        <input type="text" id="vCodeInp" placeholder="å» å•†ä»£ç¢¼">
        <input type="text" id="vNameInp" placeholder="å» å•†åç¨±">
    </div>
    <button onclick="addVendor()">+ æ–°å¢å» å•†</button>
    <div id="vendorTags" style="display:flex; flex-wrap:wrap; gap:6px; margin:10px 0;"></div>
    
    <hr style="border:0; border-top:1px solid #eee; margin:15px 0;">

    <div class="row-inputs">
        <input type="text" id="colorInp" placeholder="ä»£ç¢¼:é¡è‰² (å¦‚ BLK:é»‘è‰²)">
        <button class="btn-accent" style="flex:0.5" onclick="addColor()">+ æ–°å¢é¡è‰²</button>
    </div>
    <div id="colorTags" style="display:flex; flex-wrap:wrap; gap:6px; margin-bottom:15px;"></div>

    <div class="row-inputs">
        <input type="text" id="typeInp" placeholder="ä»£ç¢¼:é¡åˆ¥ (å¦‚ BRA:å…§è¡£)">
        <button class="btn-accent" style="flex:0.5; background:#6b7e75;" onclick="addItemType()">+ æ–°å¢é¡åˆ¥</button>
    </div>
    <div id="typeTags" style="display:flex; flex-wrap:wrap; gap:6px; margin-bottom:15px;"></div>
    
    <hr style="border:0; border-top:1px solid #eee; margin:15px 0;">

    <div class="row-inputs">
        <input type="text" id="size1Inp" placeholder="æ–°å¢ å°ºç¢¼1 (å¦‚: 32)">
        <button class="btn-accent" style="flex:0.5; background:#8da399;" onclick="addSize(1)">+ æ–°å¢å°ºç¢¼1</button>
    </div>
    <div id="size1Tags" style="display:flex; flex-wrap:wrap; gap:6px; margin-bottom:10px;"></div>

    <div class="row-inputs">
        <input type="text" id="size2Inp" placeholder="æ–°å¢ å°ºç¢¼2 (å¦‚: B)">
        <button class="btn-accent" style="flex:0.5; background:#8da399;" onclick="addSize(2)">+ æ–°å¢å°ºç¢¼2</button>
    </div>
    <div id="size2Tags" style="display:flex; flex-wrap:wrap; gap:6px; margin-bottom:10px;"></div>

    <div class="row-inputs">
        <input type="text" id="size3Inp" placeholder="æ–°å¢ å°ºç¢¼3 (å¦‚: M)">
        <button class="btn-accent" style="flex:0.5; background:#8da399;" onclick="addSize(3)">+ æ–°å¢å°ºç¢¼3</button>
    </div>
    <div id="size3Tags" style="display:flex; flex-wrap:wrap; gap:6px; margin-bottom:15px;"></div>

    <hr style="border:0; border-top:1px solid #eee; margin:15px 0;">

    <div class="field">
        <label style="font-size: 11px; font-weight: bold; color: #6b7e75;">å„²å­˜æ¬¾å¼å®šç¾©</label>
        <select id="setVendorRel"></select>
        <div class="row-inputs" style="margin-top:5px;">
            <input type="text" id="setBraId" placeholder="å‹è™Ÿ (å¦‚: A001)">
            <select id="setItemTypeSelect"></select>
        </div>
        <div class="row-inputs">
             <input type="number" id="setCost" placeholder="é€²åƒ¹ (å…§éƒ¨ç”¨)">
             <input type="number" id="setPrice" placeholder="å”®åƒ¹">
        </div>
        <button class="btn-accent" onclick="addModel()">å„²å­˜æ¬¾å¼å®šç¾©</button>
        <div id="modelTags" style="display:flex; flex-wrap:wrap; gap:6px; margin-top:10px;"></div>
    </div>
</div>
<div class="card">
    <h3>2. é€²å‡ºè²¨èˆ‡æ“ä½œ</h3>
    <div style="display: grid; grid-template-columns: 1fr 1fr 1fr; gap: 8px; margin-bottom: 10px;">
        <button style="background:#4299e1; padding:10px 5px; font-size:13px;" onclick="startScan('IN_AUTO')">ğŸ“¥ é€£çºŒå…¥åº«</button>
        <button style="background:#3182ce; padding:10px 5px; font-size:13px;" onclick="startScan('IN_MANUAL')">ğŸ“¥ å…¥åº«(å¡«é‡)</button>
        <button style="background:#48bb78; padding:10px 5px; font-size:13px;" onclick="startScan('OUT_AUTO')">ğŸ“¤ å‡ºè²¨æƒæ</button>
    </div>
    
    <div id="scanner-container">
        <div id="scan-feedback">æƒææˆåŠŸï¼</div>
        <div id="reader"></div>
        <button class="btn-danger" onclick="stopScan()">âŒ é—œé–‰ç›¸æ©Ÿ</button>
    </div>

    <div class="field">
        <select id="selectVendor" onchange="updateModelSelect()"></select>
        <select id="selectModel" style="margin-top:5px;"></select>
    </div>

    <div class="row-inputs">
        <select id="selectColor"></select>
        <select id="size1" style="flex:1;"></select>
        <select id="size2" style="flex:1;"></select>
        <select id="size3" style="flex:1;"></select>
    </div>

    <div class="field">
        <label>æ•¸é‡</label>
        <input type="number" id="braQty" value="1">
    </div>

    <div class="row-inputs">
        <button onclick="handleManual('IN')">ğŸ“¥ æ‰‹å‹•å…¥åº«</button>
        <button class="btn-success" onclick="generateInvoiceManual()">ğŸ“„ åŠ å…¥å‡ºè²¨å–®</button>
    </div>

    <div class="row-inputs admin-only" style="margin-top:10px;">
        <select id="printType" style="flex:0.4">
            <option value="A4">A4 (35å¼µ)</option>
            <option value="SINGLE">å–®å¼µ (æ¢ç¢¼æ©Ÿ)</option>
        </select>
        <button class="btn-accent" onclick="prepareTags()">ğŸ–¨ï¸ ç”¢ç”Ÿæ¨™ç±¤</button>
    </div>

    <div class="config-card admin-only">
        </div>
</div>
// [éƒ¨åˆ† 3/5] JavaScript è®Šæ•¸åˆå§‹åŒ–èˆ‡æ ¸å¿ƒé‚è¼¯æ›´æ–°
<script>
    // æ“´å……è®Šæ•¸ï¼Œæ–°å¢ sizes ç‰©ä»¶ä¾†å­˜æ”¾ä¸‰å€‹é¡åˆ¥çš„å°ºç¢¼é™£åˆ— [cite: 100]
    let vendors = [], models = [], inventory = [], colors = {}, itemTypes = {}, users = [];
    let salesHistory = [], invoiceItems = [], currentUser = null, scanMode = '';
    let compName = "æˆ‘çš„å…¬å¸", taxRate = 5;
    
    // æ–°å¢ï¼šè‡ªå®šç¾©å°ºç¢¼å„²å­˜ [cite: 104]
    let sizes = {
        s1: ["32", "34", "36", "38", "40", "42", "44", "46", "48", "50", "52"],
        s2: ["A", "B", "C", "D", "E", "F", "G", "H", "I", "J", "K"],
        s3: ["SS", "S", "M", "L", "XL", "XXL", "3XL", "4XL", "FREE"]
    };

    // ä¿®æ”¹åˆå§‹åŒ–é‚è¼¯ï¼Œè®€å–å„²å­˜çš„å°ºç¢¼ [cite: 101, 102]
    window.onload = () => {
        const d = JSON.parse(localStorage.getItem('lingerieData') || '{}');
        vendors = d.v || []; 
        models = d.m || []; 
        inventory = d.i || [];
        colors = d.c || { "BLK": "é»‘è‰²", "WHT": "ç™½è‰²" };
        itemTypes = d.t || { "BRA": "å…§è¡£", "PAN": "å…§è¤²" };
        users = d.u || [{ n: "admin", p: "1234", r: "admin" }];
        salesHistory = d.sh || [];
        compName = d.cn || "æˆ‘çš„å…¬å¸";
        taxRate = d.tr || 5;
        
        // å¦‚æœå„²å­˜è³‡æ–™ä¸­æœ‰å°ºç¢¼è¨­å®šå‰‡è¦†è“‹é è¨­å€¼ [cite: 102]
        if (d.sz) sizes = d.sz; 

        loadPrintConfigs(); 
        renderAll();
    };

    // ä¿®æ”¹å„²å­˜å‡½æ•¸ï¼Œç´å…¥ sizes [cite: 107]
    function save() {
        const data = { 
            v: vendors, m: models, i: inventory, c: colors, 
            t: itemTypes, u: users, sh: salesHistory, 
            cn: compName, tr: taxRate,
            sz: sizes // æ–°å¢å„²å­˜é …
        };
        localStorage.setItem('lingerieData', JSON.stringify(data));
        renderAll();
    }
// [éƒ¨åˆ† 4/5] å°ºç¢¼ç®¡ç†åŠŸèƒ½èˆ‡å‹•æ…‹æ¸²æŸ“
    
    // æ–°å¢å°ºç¢¼çš„åŠŸèƒ½
    function addSize(typeNum) {
        const inpId = `size${typeNum}Inp`;
        const val = document.getElementById(inpId).value.trim().toUpperCase();
        
        if (!val) return alert("è«‹è¼¸å…¥å°ºç¢¼å…§å®¹");
        if (sizes[`s${typeNum}`].includes(val)) return alert("æ­¤å°ºç¢¼å·²å­˜åœ¨");
        
        sizes[`s${typeNum}`].push(val);
        // æ’åºï¼ˆé¸ç”¨ï¼Œè®“å°ºç¢¼çœ‹èµ·ä¾†æ•´é½Šï¼‰
        sizes[`s${typeNum}`].sort((a, b) => isNaN(a) || isNaN(b) ? a.localeCompare(b) : a - b);
        
        document.getElementById(inpId).value = '';
        save();
    }

    // åˆªé™¤å°ºç¢¼çš„åŠŸèƒ½
    function delSize(typeNum, val) {
        if (confirm(`ç¢ºå®šè¦åˆªé™¤å°ºç¢¼ ${val} å—ï¼Ÿ`)) {
            sizes[`s${typeNum}`] = sizes[`s${typeNum}`].filter(s => s !== val);
            save();
        }
    }

    // æ“´å…… renderAll å‡½æ•¸ï¼Œç´å…¥å°ºç¢¼æ¨™ç±¤çš„æ›´æ–°
    function renderSizeTags() {
        for (let i = 1; i <= 3; i++) {
            const container = document.getElementById(`size${i}Tags`);
            container.innerHTML = sizes[`s${i}`].map(s => 
                `<span class="tag">${s} <b onclick="delSize(${i},'${s}')" style="margin-left:5px;color:red;cursor:pointer">Ã—</b></span>`
            ).join('');
            
            [cite_start]// åŒæ™‚æ›´æ–°é€²å‡ºè²¨å€å¡Šçš„ select ä¸‹æ‹‰é¸å–® [cite: 84]
            const selectEl = document.getElementById(`size${i}`);
            [cite_start]// åŠ å…¥ä¸€å€‹ç©ºé¸é …æˆ–é è¨­å€¼ "-" [cite: 135]
            let options = '<option value="-">-</option>'; 
            options += sizes[`s${i}`].map(s => `<option value="${s}">${s}</option>`).join('');
            selectEl.innerHTML = options;
        }
    }

    [cite_start]// æ³¨æ„ï¼šéœ€åœ¨åŸæœ¬çš„ renderAll() å‡½æ•¸å…§åŠ å…¥å° renderSizeTags() çš„å‘¼å« [cite: 124, 131]
// [éƒ¨åˆ† 5/5] æ•´åˆæ¸²æŸ“å‡½æ•¸èˆ‡æƒæå¡«å…¥é‚è¼¯

    // é‡æ–°æ•´åˆå¾Œçš„æ¸²æŸ“å‡½æ•¸
    function renderAll() {
        // 1. å» å•†ä¸‹æ‹‰é¸å–® [cite: 124]
        const vSels = ['setVendorRel', 'selectVendor'];
        vSels.forEach(s => {
            const el = document.getElementById(s);
            el.innerHTML = vendors.map(v => `<option value="${v.code}">${v.name}</option>`).join('');
        });

        // 2. é¡åˆ¥æ¨™ç±¤èˆ‡ä¸‹æ‹‰ [cite: 126, 127]
        const tTags = document.getElementById('typeTags');
        tTags.innerHTML = Object.entries(itemTypes).map(([c, n]) => `<span class="tag">${c}:${n} <b onclick="delType('${c}')" style="margin-left:5px;color:red;cursor:pointer">Ã—</b></span>`).join('');
        const tSel = document.getElementById('setItemTypeSelect');
        tSel.innerHTML = Object.entries(itemTypes).map(([c, n]) => `<option value="${c}">${n}</option>`).join('');

        // 3. é¡è‰²æ¨™ç±¤èˆ‡ä¸‹æ‹‰ [cite: 128, 129]
        const cTags = document.getElementById('colorTags');
        cTags.innerHTML = Object.entries(colors).map(([c, n]) => `<span class="tag">${c}:${n} <b onclick="delColor('${c}')" style="margin-left:5px;color:red;cursor:pointer">Ã—</b></span>`).join('');
        const cSel = document.getElementById('selectColor');
        cSel.innerHTML = Object.entries(colors).map(([c, n]) => `<option value="${c}">${n}(${c})</option>`).join('');

        // 4. å» å•†èˆ‡æ¬¾å¼æ¨™ç±¤ [cite: 129, 130]
        document.getElementById('vendorTags').innerHTML = vendors.map(v => `<span class="tag">${v.name}(${v.code}) <b onclick="delVendor('${v.code}')" style="margin-left:5px;color:red;cursor:pointer">Ã—</b></span>`).join('');
        document.getElementById('modelTags').innerHTML = models.map(m => `<span class="tag">${m.vCode}/${m.braId} <b onclick="delModel('${m.vCode}','${m.braId}')" style="margin-left:5px;color:red;cursor:pointer">Ã—</b></span>`).join('');
        
        // 5. å‘¼å«ç¬¬å››éƒ¨åˆ†æ–°å¢çš„å°ºç¢¼æ¸²æŸ“
        renderSizeTags();
        
        updateModelSelect(); // [cite: 132]
        renderInventory(); // [cite: 141]
        renderSales(); // [cite: 131]
    }

    // å¾®èª¿æƒæå¡«å…¥é‚è¼¯ï¼šæ”¹ç‚ºå¡«å…¥ select çš„å€¼ [cite: 151]
    function onScanSuccess(decodedText) {
        const p = decodedText.split(',');
        if (p.length < 7) return;
        const [v, b, t, c, s1, s2, s3] = p; // [cite: 148]
        
        const feedback = document.getElementById('scan-feedback');
        feedback.style.display = 'block'; // [cite: 149]
        setTimeout(() => feedback.style.display = 'none', 1000);

        if (scanMode === 'IN_AUTO') {
            processInventory(v, b, c, s1, s2, s3, 1); // [cite: 150]
        } else if (scanMode === 'IN_MANUAL') {
            stopScan(); // [cite: 151]
            document.getElementById('selectVendor').value = v;
            updateModelSelect();
            document.getElementById('selectModel').value = b;
            document.getElementById('selectColor').value = c;
            // æ”¹ç‚ºé¸å–ä¸‹æ‹‰é¸å–®çš„å€¼
            document.getElementById('size1').value = s1;
            document.getElementById('size2').value = s2;
            document.getElementById('size3').value = s3;
        } else if (scanMode === 'OUT_AUTO') {
            addToInvoice(v, b, c, s1, s2, s3, 1); // [cite: 153]
        }
    }
</script>
</body>
</html>
