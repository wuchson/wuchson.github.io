<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>å€‹äººåŠ å¯†ä¿éšªç®± Pro</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/crypto-js/4.1.1/crypto-js.min.js"></script>
    <style>
        :root {
            --primary-color: #4a90e2;
            --success-color: #28a745;
            --bg-color: #f0f2f5;
        }
        body { font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; background: var(--bg-color); padding: 20px; display: flex; justify-content: center; }
        .container { background: white; padding: 30px; border-radius: 12px; box-shadow: 0 4px 20px rgba(0,0,0,0.1); width: 100%; max-width: 550px; }
        h2 { color: #333; text-align: center; margin-bottom: 5px; }
        p.subtitle { text-align: center; color: #666; font-size: 0.9em; margin-bottom: 25px; }
        
        .label { font-weight: bold; display: block; margin-bottom: 5px; color: #444; }
        input[type="password"], input[type="text"], textarea {
            width: 100%; padding: 12px; margin-bottom: 15px; border: 1px solid #ddd; border-radius: 6px; box-sizing: border-box; font-size: 14px;
        }
        textarea { height: 180px; resize: vertical; font-family: monospace; }
        
        .btns { display: grid; grid-template-columns: 1fr 1fr; gap: 15px; margin-top: 10px; }
        button { 
            padding: 12px; border: none; border-radius: 6px; color: white; font-weight: bold; cursor: pointer; transition: opacity 0.2s; font-size: 15px;
        }
        button:hover { opacity: 0.9; }
        .save-btn { background-color: var(--success-color); }
        .load-btn { background-color: var(--primary-color); }
        
        .file-section { margin-top: 25px; padding-top: 20px; border-top: 1px dashed #ccc; }
        .hint { color: #d9534f; font-size: 0.85em; margin-top: 5px; }
    </style>
</head>
<body>

<div class="container">
    <h2>ğŸ” ç§äººåŠ å¯†ä¿éšªç®±</h2>
    <p class="subtitle">æ‰€æœ‰åŠ å¯†å‡åœ¨æœ¬åœ°å®Œæˆï¼Œè³‡æ–™ä¸æœƒä¸Šå‚³ç¶²è·¯</p>
    
    <label class="label">1. è¨­å®šä¸»å¯†ç¢¼ (Master Key)</label>
    <input type="password" id="masterKey" placeholder="è«‹è¼¸å…¥è¶³ä»¥ä¿è­·æ‰€æœ‰å¸³å¯†çš„å¼·å¤§å¯†ç¢¼">
    
    <label class="label">2. å…§å®¹ (å¸³è™Ÿ/å¯†ç¢¼/ç§å¯†ç­†è¨˜)</label>
    <textarea id="content" placeholder="è«‹åœ¨æ­¤è¼¸å…¥å…§å®¹..."></textarea>
    
    <label class="label">3. å­˜æª”åç¨± (é¸å¡«)</label>
    <input type="text" id="fileNameInput" placeholder="é è¨­ç‚º: å¯†ç¢¼å‚™ä»½_æ—¥æœŸ">

    <div class="btns">
        <button class="save-btn" onclick="encryptAndDownload()">ğŸ”’ åŠ å¯†ä¸¦å­˜æª”</button>
        <button class="load-btn" onclick="document.getElementById('fileInput').click()">ğŸ”“ è®€å–èˆŠå­˜æª”</button>
    </div>
    
    <div class="file-section">
        <label class="label">é¸æ“‡è¦è§£å¯†çš„æª”æ¡ˆï¼š</label>
        <input type="file" id="fileInput" onchange="decryptFile()">
        <p class="hint">â€» æ³¨æ„ï¼šè§£å¯†å‰è«‹å…ˆåœ¨ä¸Šæ–¹è¼¸å…¥æ­£ç¢ºçš„ä¸»å¯†ç¢¼ã€‚</p>
    </div>
</div>

<script>
    // å–å¾—ä»Šå¤©çš„æ—¥æœŸå­—ä¸² (æ ¼å¼: 2024-05-20)
    function getToday() {
        const now = new Date();
        return now.getFullYear() + "-" + (now.getMonth() + 1).toString().padStart(2, '0') + "-" + now.getDate().toString().padStart(2, '0');
    }

    // åŠ å¯†ä¸¦ä¸‹è¼‰
    function encryptAndDownload() {
        const password = document.getElementById('masterKey').value;
        const text = document.getElementById('content').value;
        let customName = document.getElementById('fileNameInput').value.trim();
        
        if (!password) return alert("è«‹è¼¸å…¥ã€Œä¸»å¯†ç¢¼ã€ä¾†ä¿è­·æ‚¨çš„è³‡æ–™ï¼");
        if (!text) return alert("è«‹è¼¸å…¥è¦åŠ å¯†çš„å…§å®¹ï¼");

        // åŸ·è¡Œ AES åŠ å¯†
        const encrypted = CryptoJS.AES.encrypt(text, password).toString();
        
        // æ±ºå®šæª”å
        const fileName = (customName || "å¯†ç¢¼å‚™ä»½") + "_" + getToday() + ".txt";
        
        // ä¸‹è¼‰æª”æ¡ˆ
        const blob = new Blob([encrypted], {type: "text/plain"});
        const a = document.createElement("a");
        a.href = URL.createObjectURL(blob);
        a.download = fileName;
        a.click();
        
        alert("åŠ å¯†æˆåŠŸï¼æª”æ¡ˆå·²å­˜ç‚º: " + fileName);
    }

    // è®€å–æª”æ¡ˆä¸¦è§£å¯†
    function decryptFile() {
        const password = document.getElementById('masterKey').value;
        const fileInput = document.getElementById('fileInput');
        
        if (!password) {
            alert("è«‹å…ˆè¼¸å…¥ç•¶åˆè¨­å®šçš„ã€Œä¸»å¯†ç¢¼ã€ï¼Œå¦å‰‡ç„¡æ³•è§£å¯†ï¼");
            fileInput.value = ""; // æ¸…ç©ºé¸å–
            return;
        }

        const file = fileInput.files[0];
        if (!file) return;

        const reader = new FileReader();
        reader.onload = function(e) {
            const encryptedData = e.target.result;
            try {
                // å˜—è©¦è§£å¯†
                const bytes = CryptoJS.AES.decrypt(encryptedData, password);
                const decryptedText = bytes.toString(CryptoJS.enc.Utf8);
                
                if (decryptedText) {
                    document.getElementById('content').value = decryptedText;
                    alert("è§£å¯†æˆåŠŸï¼å…§å®¹å·²é¡¯ç¤ºåœ¨æ–‡å­—æ¡†ä¸­ã€‚");
                } else {
                    throw new Error();
                }
            } catch (e) {
                alert("è§£å¯†å¤±æ•—ï¼å¯èƒ½åŸå› ï¼š\n1. ä¸»å¯†ç¢¼è¼¸å…¥éŒ¯èª¤\n2. æª”æ¡ˆä¸¦éæ­¤ç¨‹å¼ç”¢ç”Ÿçš„åŠ å¯†æª”");
            }
        };
        reader.readAsText(file);
    }
</script>

</body>
</html>
