<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>å°Šçˆµè³ªæ„ŸæŠ½çç³»çµ±</title>
    <script src="https://cdn.jsdelivr.net/npm/xlsx@0.18.5/dist/xlsx.full.min.js"></script>
    <style>
        :root {
            --theme-primary: #d4af37;
            --theme-secondary: #f9e29c;
            --theme-bg-1: #1a1a2e;
            --theme-bg-2: #050505;
            --glass: rgba(255, 255, 255, 0.05);
        }

        /* å„ç¨®ä¸»é¡Œè‰²å®šç¾© */
        .theme-blue { --theme-primary: #4CAF50; --theme-secondary: #A5D6A7; --theme-bg-1: #00251a; --theme-bg-2: #000000; }
        .theme-purple { --theme-primary: #9C27B0; --theme-secondary: #E1BEE7; --theme-bg-1: #1a0033; --theme-bg-2: #000000; }
        .theme-red { --theme-primary: #F44336; --theme-secondary: #FFCDD2; --theme-bg-1: #330000; --theme-bg-2: #000000; }
        .theme-teal { --theme-primary: #00BCD4; --theme-secondary: #B2EBF2; --theme-bg-1: #002633; --theme-bg-2: #000000; }

        body {
            font-family: 'PingFang TC', sans-serif;
            background: radial-gradient(circle at center, var(--theme-bg-1) 0%, var(--theme-bg-2) 100%);
            color: #fff;
            margin: 0;
            padding: 10px;
            display: flex;
            flex-direction: column;
            align-items: center;
            min-height: 100vh;
            box-sizing: border-box;
        }

        .container {
            width: 100%;
            max-width: 500px; /* æ‰‹æ©Ÿç‰ˆå¯¬åº¦å„ªåŒ– */
            background: var(--glass);
            backdrop-filter: blur(15px);
            border: 1px solid rgba(255,255,255,0.1);
            border-radius: 20px;
            padding: 20px;
            box-shadow: 0 15px 35px rgba(0,0,0,0.5);
            box-sizing: border-box;
        }

        /* é¡è‰²æŒ‰éˆ•å€ */
        .theme-switcher {
            display: flex;
            justify-content: center;
            gap: 12px;
            margin-bottom: 20px;
        }
        .theme-dot {
            width: 25px;
            height: 25px;
            border-radius: 5px;
            cursor: pointer;
            border: 2px solid transparent;
        }
        .theme-dot.active { border-color: #fff; transform: scale(1.1); }

        /* è¼¸å…¥èˆ‡è¨­å®šå€ */
        .config-section {
            display: flex;
            flex-direction: column;
            gap: 12px;
            margin-bottom: 20px;
        }
        .config-group { display: flex; flex-direction: column; gap: 5px; }
        .label { color: var(--theme-primary); font-size: 0.8rem; font-weight: bold; }
        
        input, textarea {
            background: rgba(0,0,0,0.4);
            border: 1px solid #444;
            color: #fff;
            padding: 8px;
            border-radius: 8px;
            font-size: 14px;
        }
        textarea { height: 60px; resize: none; }

        /* è¦–è¦ºé¡¯ç¤ºå€ */
        .display-area {
            text-align: center;
            padding: 10px 0;
        }
        #main-title {
            color: var(--theme-primary);
            font-size: 1.8rem;
            margin: 0 0 10px 0;
            letter-spacing: 3px;
            text-transform: uppercase;
        }
        #lucky-box {
            font-size: 3.5rem;
            height: 120px;
            display: flex;
            justify-content: center;
            align-items: center;
            background: rgba(255,255,255,0.02);
            border-radius: 15px;
            margin-bottom: 15px;
            text-shadow: 0 0 15px var(--theme-primary);
        }

        /* æŠ½çæŒ‰éˆ• - ç¢ºä¿ä¸æœƒè¢«åˆ‡æ‰ */
        .draw-btn {
            width: 100%;
            padding: 15px;
            font-size: 1.4rem;
            font-weight: bold;
            border-radius: 40px;
            border: none;
            background: linear-gradient(45deg, var(--theme-primary), var(--theme-secondary));
            color: #000;
            cursor: pointer;
            box-shadow: 0 5px 15px rgba(0,0,0,0.3);
            margin-bottom: 20px;
        }
        .draw-btn:disabled { filter: grayscale(1); opacity: 0.5; }

        /* ä¸­çå€ */
        .winner-section { border-top: 1px solid rgba(255,255,255,0.1); padding-top: 15px; }
        .winner-list { display: grid; grid-template-columns: repeat(2, 1fr); gap: 10px; margin-top: 10px; }
        .winner-item {
            background: rgba(255,255,255,0.05);
            border: 1px solid var(--theme-primary);
            padding: 8px;
            border-radius: 8px;
            text-align: center;
            font-size: 0.9rem;
            animation: pop 0.3s ease;
        }
        @keyframes pop { from { transform: scale(0.8); } to { transform: scale(1); } }

        .sub-btn {
            background: transparent;
            border: 1px solid var(--theme-primary);
            color: var(--theme-primary);
            padding: 5px 10px;
            border-radius: 5px;
            font-size: 0.7rem;
            cursor: pointer;
        }
    </style>
</head>
<body class="theme-default">

    <div class="container">
        <div class="theme-switcher">
            <div class="theme-dot active" style="background: #d4af37;" onclick="changeTheme('', this)"></div>
            <div class="theme-dot" style="background: #4CAF50;" onclick="changeTheme('blue', this)"></div>
            <div class="theme-dot" style="background: #9C27B0;" onclick="changeTheme('purple', this)"></div>
            <div class="theme-dot" style="background: #F44336;" onclick="changeTheme('red', this)"></div>
            <div class="theme-dot" style="background: #00BCD4;" onclick="changeTheme('teal', this)"></div>
        </div>

        <div class="config-section">
            <div class="config-group">
                <span class="label">æ´»å‹•æ¨™é¡Œ</span>
                <input type="text" id="tInput" placeholder="è¼¸å…¥æ´»å‹•åç¨±..." oninput="updateT(this.value)">
            </div>
            <div style="display:flex; gap:10px;">
                <div class="config-group" style="flex:1;">
                    <span class="label">æŠ½å–äººæ•¸</span>
                    <input type="number" id="nCount" value="1" min="1">
                </div>
                <div class="config-group" style="flex:1;">
                    <span class="label">Excel åŒ¯å…¥</span>
                    <button class="sub-btn" onclick="document.getElementById('fUp').click()">é¸æ“‡æª”æ¡ˆ</button>
                    <input type="file" id="fUp" accept=".xlsx, .xls" style="display:none">
                </div>
            </div>
            <div class="config-group">
                <span class="label">åå–® (ä¸€äººä¸€è¡Œ)</span>
                <textarea id="nameList" placeholder="è«‹è¼¸å…¥æˆ–åŒ¯å…¥åå–®..."></textarea>
            </div>
        </div>

        <div class="display-area">
            <h1 id="main-title">ROYAL DRAW</h1>
            <div id="lucky-box">Ready</div>
            <button id="drawBtn" class="draw-btn" onclick="startDraw()">é–‹å§‹æŠ½ç</button>
        </div>

        <div class="winner-section">
            <div style="display:flex; justify-content:space-between; align-items:center;">
                <span class="label">ğŸ† ä¸­çåå–®</span>
                <button class="sub-btn" onclick="exportExcel()">åŒ¯å‡ºåå–®</button>
            </div>
            <div id="wList" class="winner-list"></div>
        </div>
    </div>

    <script>
        let winners = [];
        let drawing = false;
        const audio = new (window.AudioContext || window.webkitAudioContext)();

        function changeTheme(cls, el) {
            document.body.className = cls ? 'theme-' + cls : '';
            document.querySelectorAll('.theme-dot').forEach(d => d.classList.remove('active'));
            el.classList.add('active');
        }

        function updateT(v) { document.getElementById('main-title').innerText = v || "ROYAL DRAW"; }

        function beep(f, d) {
            const o = audio.createOscillator();
            const g = audio.createGain();
            o.frequency.value = f;
            g.gain.setValueAtTime(0.05, audio.currentTime);
            o.connect(g); g.connect(audio.destination);
            o.start(); o.stop(audio.currentTime + d);
        }

        document.getElementById('fUp').addEventListener('change', (e) => {
            const reader = new FileReader();
            reader.onload = (ev) => {
                const sheet = XLSX.read(ev.target.result, {type:'array'}).Sheets;
                const data = XLSX.utils.sheet_to_json(sheet[Object.keys(sheet)[0]], {header:1});
                document.getElementById('nameList').value = data.flat().filter(n => n).join('\n');
            };
            reader.readAsArrayBuffer(e.target.files[0]);
        });

        function startDraw() {
            if(drawing) return;
            const names = document.getElementById('nameList').value.split('\n').filter(n => n.trim());
            const num = parseInt(document.getElementById('nCount').value);
            if(names.length < num) return alert("äººæ•¸ä¸è¶³");

            drawing = true;
            const btn = document.getElementById('drawBtn');
            const box = document.getElementById('lucky-box');
            btn.disabled = true;

            let start = Date.now();
            const timer = setInterval(() => {
                box.innerText = names[Math.floor(Math.random()*names.length)];
                beep(300, 0.05);
                if(Date.now() - start > 1500) {
                    clearInterval(timer);
                    let result = [];
                    for(let i=0; i<num; i++) {
                        const idx = Math.floor(Math.random()*names.length);
                        result.push(names.splice(idx, 1)[0]);
                    }
                    document.getElementById('nameList').value = names.join('\n');
                    box.innerText = result.length > 1 ? "æ­å–œä¸­ç" : result[0];
                    result.forEach(w => {
                        winners.push(w);
                        const item = document.createElement('div');
                        item.className = 'winner-item';
                        item.innerText = w;
                        document.getElementById('wList').prepend(item);
                    });
                    beep(600, 0.5);
                    drawing = false; btn.disabled = false;
                }
            }, 60);
        }

        function exportExcel() {
            if(!winners.length) return;
            const ws = XLSX.utils.json_to_sheet(winners.map(w => ({ "ä¸­çè€…": w })));
            const wb = XLSX.utils.book_new();
            XLSX.utils.book_append_sheet(wb, ws, "Winners");
            XLSX.writeFile(wb, "ä¸­çåå–®.xlsx");
        }
    </script>
</body>
</html>
