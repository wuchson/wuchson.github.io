<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>æ°´å¢¨æ­²æœˆ - ç¦ªæ„æ›ç®—</title>
    <style>
        :root {
            --paper: #fcfaf2;   /* ä»¿å¤å®£ç´™ */
            --ink-dark: #1a1a1b; /* æ¿ƒå¢¨ */
            --ink-light: #525252;/* ç„¦å¢¨ */
            --wash: #e5e5e5;    /* å¢¨éŸ» */
            --accent: #262626;  /* ç‚­è‰² */
            --seal: #a63d40;    /* å°æ³¥ç´… */
        }

        body {
            font-family: 'Kaiti', 'STKaiti', 'è¯æ–‡æ¥·é«”', 'PingFang TC', serif;
            background-color: #dcdcdc;
            background-image: 
                radial-gradient(circle at 50% 50%, rgba(255,255,255,0.4) 0%, transparent 80%),
                url("https://www.transparenttextures.com/patterns/handmade-paper.png");
            color: var(--ink-dark);
            display: flex;
            justify-content: center;
            align-items: center;
            min-height: 100vh;
            margin: 0;
        }

        .card {
            background-color: var(--paper);
            padding: 40px;
            border: 1px solid #c9c3af;
            box-shadow: 0 20px 50px rgba(0,0,0,0.15);
            width: 90%;
            max-width: 420px;
            position: relative;
            overflow: hidden;
        }

        /* æ°´å¢¨è£é£¾ */
        .card::after {
            content: "";
            position: absolute;
            bottom: -50px;
            right: -50px;
            width: 150px;
            height: 150px;
            background: radial-gradient(circle, rgba(0,0,0,0.05) 0%, transparent 70%);
            border-radius: 50%;
            z-index: 0;
        }

        h2 { 
            text-align: center; 
            margin-top: 0; 
            color: var(--ink-dark); 
            letter-spacing: 12px; 
            font-size: 2rem;
            position: relative;
            font-weight: normal;
        }

        h2::after {
            content: "ZEN";
            position: absolute;
            font-size: 0.7rem;
            bottom: -15px;
            left: 50%;
            transform: translateX(-50%);
            letter-spacing: 2px;
            color: var(--seal);
            opacity: 0.6;
        }

        .type-selector {
            display: flex;
            justify-content: center;
            gap: 20px;
            margin: 30px 0;
        }

        .type-btn {
            background: transparent;
            border: none;
            color: var(--ink-light);
            cursor: pointer;
            font-size: 1rem;
            padding: 5px 10px;
            transition: 0.4s;
            border-bottom: 1px solid transparent;
        }

        .type-btn.active { 
            color: var(--seal);
            border-bottom: 1px solid var(--seal);
        }

        .input-label { 
            font-size: 0.85rem; 
            color: var(--ink-light); 
            margin-bottom: 10px; 
            display: block; 
            text-align: center;
            letter-spacing: 2px;
        }

        .input-group { 
            display: flex; 
            gap: 10px; 
            margin-bottom: 30px; 
            position: relative;
            z-index: 1;
        }

        input[type="number"], select {
            background: transparent;
            border: none;
            border-bottom: 1px solid #d1c7a7;
            color: var(--ink-dark);
            padding: 8px;
            font-size: 1.1rem;
            text-align: center;
            font-family: inherit;
            outline: none;
            width: 100%;
            transition: 0.3s;
        }

        input:focus, select:focus { border-bottom-color: var(--seal); }

        .result-box {
            margin-top: 30px;
            border-top: 1px solid #eee;
            padding-top: 25px;
            display: none;
            animation: fadeIn 1s ease;
        }

        @keyframes fadeIn { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }

        .result-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 20px;
        }

        .result-item {
            text-align: center;
        }

        .res-label { 
            font-size: 0.75rem; 
            color: var(--ink-light); 
            margin-bottom: 8px;
            letter-spacing: 1px;
        }

        .res-value { 
            color: var(--ink-dark); 
            font-weight: 500; 
            font-size: 1.2rem;
            display: block;
        }
        
        .full-width { grid-column: span 2; margin-top: 10px; }

        .fortune-box {
            margin-top: 30px;
            padding: 20px;
            background: rgba(0,0,0,0.02);
            border-radius: 4px;
            font-size: 0.95rem;
            color: var(--ink-light);
            line-height: 2;
            text-align: justify;
            border-left: 1px solid var(--seal);
        }

        .fortune-box strong {
            color: var(--seal);
            font-weight: normal;
            display: block;
            margin-bottom: 10px;
            font-size: 1.1rem;
        }

        /* å°ç« æ¨£å¼ */
        .seal {
            width: 35px;
            height: 35px;
            border: 2px solid var(--seal);
            color: var(--seal);
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: bold;
            font-size: 0.7rem;
            line-height: 1.1;
            margin: 0 auto 20px;
            padding: 2px;
            opacity: 0.8;
        }
    </style>
</head>
<body>

<div class="card">
    <div class="seal">æ­²æœˆ<br>éœå¥½</div>
    <h2>åºšçºŒæ­²æœˆ</h2>
    
    <div class="type-selector">
        <button class="type-btn active" id="btnAD" onclick="setMode('AD')">è¥¿å…ƒ</button>
        <button class="type-btn" id="btnROC" onclick="setMode('ROC')">æ°‘åœ‹</button>
    </div>

    <label class="input-label">è«‹é¸å–é™ç”Ÿè¾°æ™‚</label>
    <div class="input-group">
        <input type="number" id="year" placeholder="å¹´" oninput="calculate()">
        <select id="month" onchange="calculate()"><option value="">æœˆ</option></select>
        <select id="day" onchange="calculate()"><option value="">æ—¥</option></select>
    </div>

    <div id="resultBox" class="result-box">
        <div class="result-grid">
            <div class="result-item"><span class="res-label">ç›®å‰è¶³æ­²</span><span class="res-value" id="resAge">0 æ­²</span></div>
            <div class="result-item"><span class="res-label">å¡µä¸–å…‰é™°</span><span class="res-value" id="resDays">0 å¤©</span></div>
            <div class="result-item"><span class="res-label">æ˜Ÿå®¿</span><span class="res-value" id="resStar">-</span></div>
            <div class="result-item"><span class="res-label">ç´€å¹´æ›ç®—</span><span class="res-value" id="resConvert">-</span></div>
            <div class="result-item full-width"><span class="res-label">è¾²æ›†æ­²æ¬¡ (æœˆæ—¥/ç¯€æ°£)</span><span class="res-value" id="resLunar">-</span></div>
        </div>
        <div id="fortuneBox" class="fortune-box"></div>
    </div>
</div>

<script>
    let mode = 'AD';
    const yearEl = document.getElementById('year');
    const monthEl = document.getElementById('month');
    const dayEl = document.getElementById('day');
    const resBox = document.getElementById('resultBox');

    for(let i=1; i<=12; i++) monthEl.add(new Option(i, i));
    for(let i=1; i<=31; i++) dayEl.add(new Option(i, i));

    const zodiacTips = {
        'é¼ ': 'æ©Ÿæ•è°æ…§ï¼Œè‹¥èƒ½éœæ°´æµæ·±ï¼Œå‰‡å¯é¿é–‹ç´›æ“¾ã€‚',
        'ç‰›': 'å‹¤æ‡‡å‹™å¯¦ã€‚å‡¡äº‹ä¸å¿…æ€¥æ–¼æ±‚æˆï¼Œåšç©è€Œè–„ç™¼ã€‚',
        'è™': 'å¨å„€ä¸å‡¡ã€‚ä»Šå¹´æ‡‰æ”¶æ–‚é‹’èŠ’ï¼Œè¬™å’Œè‡ªèƒ½æ‹›ç¦ã€‚',
        'å…”': 'æº«å©‰ç´°è†©ã€‚é©å®œå»£çµå–„ç·£ï¼Œäººå’Œæ–¹èƒ½äº‹èˆˆã€‚',
        'é¾': 'å¿—å‘é å¤§ã€‚æˆ’é©•æˆ’èºï¼Œå¦‚é¾æ½›æ·±æ·µï¼Œå¾…æ™‚è€Œå‹•ã€‚',
        'è›‡': 'ç›´è¦ºæ•éŠ³ã€‚å…§æ±‚è€Œä¸å¤–ç‚«ï¼Œå­¸å•ç²¾é€²ä¹‹æ™‚ã€‚',
        'é¦¬': 'ç†±æƒ…å¥”æ”¾ã€‚å‹•ä¸­æœ‰å‰ï¼Œç„¶é ˆå¿ƒç¹«ä¸€è™•ï¼Œè«è¦æ•£äº‚ã€‚',
        'ç¾Š': 'æ€§æƒ…æº«å’Œã€‚ä¿æŒå…§å¿ƒå¹³éœï¼Œç¦å ±è‡ªæœƒéš¨è¡Œã€‚',
        'çŒ´': 'æ´»æ½‘éˆå‹•ã€‚åˆ©æ–¼ç ”ç¿’æ–°æŠ€ï¼Œæ›´é€²ä¸€ç«¿ã€‚',
        'é›': 'ç²¾æ˜å¹¹ç·´ã€‚äº‹æ¥­å®ˆæˆç‚ºä¸Šï¼Œå¦‚ç´°æ°´é•·æµã€‚',
        'ç‹—': 'å¿ ç¾©æ­£ç›´ã€‚ç©©ç´®ç©©æ‰“ï¼Œå¹³å®‰å³æ˜¯æœ€å¤§çš„ç¦åˆ†ã€‚',
        'è±¬': 'å¯¬åšé–‹æœ—ã€‚çŸ¥è¶³å¸¸æ¨‚ï¼Œè²¡æºå¦‚æ˜¥æ°´è‡ªç„¶ã€‚'
    };

    const solarTerms = ["å°å¯’/å¤§å¯’", "ç«‹æ˜¥/é›¨æ°´", "é©šèŸ„/æ˜¥åˆ†", "æ¸…æ˜/ç©€é›¨", "ç«‹å¤/å°æ»¿", "èŠ’ç¨®/å¤è‡³", "å°æš‘/å¤§æš‘", "ç«‹ç§‹/è™•æš‘", "ç™½éœ²/ç§‹åˆ†", "å¯’éœ²/éœœé™", "ç«‹å†¬/å°é›ª", "å¤§é›ª/å†¬è‡³"];

    function setMode(newMode) {
        if (mode === newMode) return;
        let val = parseInt(yearEl.value);
        if (val) yearEl.value = (newMode === 'ROC') ? val - 1911 : val + 1911;
        mode = newMode;
        document.getElementById('btnAD').classList.toggle('active', mode === 'AD');
        document.getElementById('btnROC').classList.toggle('active', mode === 'ROC');
        calculate();
    }

    function getLunarFullInfo(date) {
        try {
            const yearFormatter = new Intl.DateTimeFormat('zh-Hant-TW-u-ca-chinese', { year: 'numeric' });
            const lunarYearStr = yearFormatter.format(date); 
            let ganzhi = "";
            const gzMatch = lunarYearStr.match(/[ç”²ä¹™ä¸™ä¸æˆŠå·±åºšè¾›å£¬ç™¸][å­ä¸‘å¯…å¯è¾°å·³åˆæœªç”³é…‰æˆŒäº¥]/);
            if (gzMatch) {
                ganzhi = gzMatch[0];
            } else {
                const lYearNum = parseInt(lunarYearStr.replace(/[^0-9]/g, ''));
                const gan = ["ç”²", "ä¹™", "ä¸™", "ä¸", "æˆŠ", "å·±", "åºš", "è¾›", "å£¬", "ç™¸"];
                const zhi = ["å­", "ä¸‘", "å¯…", "å¯", "è¾°", "å·³", "åˆ", "æœª", "ç”³", "é…‰", "æˆŒ", "äº¥"];
                const offset = lYearNum - 4;
                ganzhi = gan[((offset % 10) + 10) % 10] + zhi[((offset % 12) + 12) % 12];
            }
            const zodiac = {'å­':'é¼ ','ä¸‘':'ç‰›','å¯…':'è™','å¯':'å…”','è¾°':'é¾','å·³':'è›‡','åˆ':'é¦¬','æœª':'ç¾Š','ç”³':'çŒ´','é…‰':'é›','æˆŒ':'ç‹—','äº¥':'è±¬'}[ganzhi.charAt(1)];
            const mdFormatter = new Intl.DateTimeFormat('zh-TW-u-ca-chinese', { month: 'numeric', day: 'numeric' });
            let rawMD = mdFormatter.format(date).replace(/\s/g, '');
            const monthNames = ["æ­£æœˆ", "äºŒæœˆ", "ä¸‰æœˆ", "å››æœˆ", "äº”æœˆ", "å…­æœˆ", "ä¸ƒæœˆ", "å…«æœˆ", "ä¹æœˆ", "åæœˆ", "åä¸€æœˆ", "åäºŒæœˆ"];
            let lunarMD = rawMD;
            for (let i = 1; i <= 12; i++) {
                let mCode = "M" + (i < 10 ? "0" + i : i);
                let mNum = i.toString();
                if (lunarMD.startsWith(mCode)) {
                    lunarMD = lunarMD.replace(mCode, monthNames[i-1]);
                    break;
                } else if (lunarMD.match(/^\d+/) && lunarMD.match(/^\d+/)[0] === mNum) {
                    lunarMD = lunarMD.replace(mNum, monthNames[i-1]);
                    break;
                }
            }
            if (!lunarMD.includes('æ—¥')) lunarMD += 'æ—¥';
            return { display: `${ganzhi}(${zodiac})å¹´ ${lunarMD} [${solarTerms[date.getMonth()]}]`, zodiac: zodiac };
        } catch (e) { return { display: "åœç®—ä¸­...", zodiac: "" }; }
    }

    function getStarSign(m, d) {
        const signs = ["æ‘©ç¾¯","æ°´ç“¶","é›™é­š","ç‰¡ç¾Š","é‡‘ç‰›","é›™å­","å·¨èŸ¹","ç…å­","è™•å¥³","å¤©ç§¤","å¤©è ","å°„æ‰‹","æ‘©ç¾¯"];
        const bounds = [20, 19, 20, 20, 21, 21, 23, 23, 23, 23, 22, 22];
        return signs[m - 1 + (d > bounds[m - 1] ? 1 : 0)] + "åº§";
    }

    function calculate() {
        const y = parseInt(yearEl.value);
        const m = parseInt(monthEl.value);
        const d = parseInt(dayEl.value);
        if (!y || !m || !d) { resBox.style.display = 'none'; return; }
        let adYear = (mode === 'ROC') ? y + 1911 : y;
        const birth = new Date(adYear, m - 1, d);
        const today = new Date();
        if (birth.getFullYear() !== adYear || birth.getMonth() !== m - 1 || birth.getDate() !== d || birth > today) {
            resBox.style.display = 'none'; 
            return; 
        }
        let age = today.getFullYear() - birth.getFullYear();
        if (today.getMonth() < birth.getMonth() || (today.getMonth() === birth.getMonth() && today.getDate() < birth.getDate())) age--;
        const lunarInfo = getLunarFullInfo(birth);
        resBox.style.display = 'block';
        document.getElementById('resAge').innerText = age + " æ­²";
        document.getElementById('resDays').innerText = Math.floor((today - birth) / 86400000).toLocaleString() + " å¤©";
        document.getElementById('resConvert').innerText = (mode === 'AD') ? `æ°‘åœ‹ ${adYear-1911} å¹´` : `è¥¿å…ƒ ${adYear} å¹´`;
        document.getElementById('resStar').innerText = getStarSign(m, d);
        document.getElementById('resLunar').innerText = lunarInfo.display;
        document.getElementById('fortuneBox').innerHTML = `<strong>ğŸ® ${lunarInfo.zodiac}å±¬ç¦ªèªï¼š</strong>${zodiacTips[lunarInfo.zodiac]}`;
    }
</script>

</body>
</html>
