<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>文字轉語音閱讀器</title>
    <style>
        /* --- 全域基礎樣式 --- */
        body {
            font-family: '微軟正黑體', 'Helvetica Neue', Helvetica, Arial, sans-serif;
            line-height: 1.8;
            margin: 0;
            padding: 0;
            background-color: #f7f7f7;
            color: #222;
        }

        /* --- 核心閱讀器容器樣式 (手機響應式優先) --- */
        .reader-container {
            width: 100%; /* 手機上佔滿寬度 */
            padding: 20px; /* 內邊距，避免貼邊 */
            box-sizing: border-box; 
            margin: 0 auto; /* 預設置頂 (margin: 0) 和水平置中 (auto) */
            background-color: #fff;
            box-shadow: 0 0 10px rgba(0, 0, 0, 0.05); 
            border-radius: 0; /* 手機上移除圓角 */
            min-height: 100vh; /* 確保容器至少佔滿整個螢幕高度 */
        }

        /* --- 電腦螢幕響應式調整 (置中、置頂、最大寬度、圓角) --- */
        @media (min-width: 768px) {
            .reader-container {
                max-width: 900px; /* 限制電腦版寬度 */
                margin: 20px auto 40px auto; /* 頂部 20px 邊距 (置頂效果) + 水平置中 */
                box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1); 
                border-radius: 12px; /* 恢復圓角 */
                min-height: auto;
            }
        }

        /* --- 其他元件樣式 --- */
        h1 {
            color: #0056b3;
            border-bottom: 3px solid #eee;
            padding-bottom: 15px;
            margin-bottom: 30px;
        }

        /* 文字輸入框樣式 */
        #articleInput {
            width: 100%;
            min-height: 300px; 
            padding: 15px;
            box-sizing: border-box;
            border: 1px solid #ccc;
            border-radius: 6px;
            font-size: 16px;
            line-height: 1.6;
            resize: vertical;
            font-family: inherit;
        }
        @media (min-width: 768px) {
             #articleInput {
                min-height: 400px; 
             }
        }

        /* 控制區塊樣式 */
        .controls {
            display: flex;
            flex-direction: column;
            gap: 15px;
            margin-bottom: 25px;
            padding: 15px;
            background-color: #f0f8ff;
            border-radius: 8px;
            border: 1px solid #cceeff;
        }
        
        /* 語言選擇容器樣式 */
        .language-control {
            display: flex;
            gap: 10px;
            align-items: center;
        }

        /* 按鈕容器樣式 */
        .button-controls {
            display: flex;
            gap: 15px;
            flex-wrap: wrap; 
        }

        .tts-button {
            padding: 12px 20px;
            font-size: 16px;
            cursor: pointer;
            border: none;
            border-radius: 6px;
            background-color: #28a745;
            color: white;
            transition: background-color 0.3s;
            flex-grow: 1; 
        }
        .tts-button:hover {
            background-color: #1e7e34;
        }
        .tts-button:disabled {
            background-color: #6c757d;
            cursor: not-allowed;
        }

        /* 語言選擇下拉選單 */
        label {
            font-weight: bold;
            color: #333;
        }
        #languageSelect {
            padding: 10px;
            border-radius: 5px;
            border: 1px solid #ccc;
            font-size: 16px;
        }
    </style>
</head>
<body>

    <div class="reader-container">
        <h1>文字轉語音閱讀器</h1>
        <p style="color: red; font-weight: bold;">注意：此工具無法自動翻譯。若您選擇英文選項，請確保輸入框中的內容是英文。</p>
        
        <div class="controls">
            
            <div class="language-control">
                <label for="languageSelect">選擇語言：</label>
                <select id="languageSelect">
                    <option value="zh-TW">中文 (台灣)</option>
                    <option value="zh-CN">中文 (中國大陸)</option>
                    <option value="en-US">英文 (美國)</option>
                    <option value="ja-JP">日文 (Japan)</option>
                    <option value="ko-KR">韓文 (Korea)</option>
                </select>
            </div>
            
            <div class="button-controls">
                <button id="startReadingBtn" class="tts-button">
                    <span id="buttonText">開始朗讀 (Start Reading)</span>
                </button>
                <button id="stopReadingBtn" class="tts-button" disabled>停止朗讀 (Stop Reading)</button>
            </div>
            
        </div>
        
        <textarea id="articleInput" placeholder="在此輸入要閱讀的文章"></textarea>

    </div>

    <script>
        const articleInput = document.getElementById('articleInput');
        const startBtn = document.getElementById('startReadingBtn');
        const stopBtn = document.getElementById('stopReadingBtn');
        const buttonText = document.getElementById('buttonText');
        const langSelect = document.getElementById('languageSelect');
        const synth = window.speechSynthesis;
        let voiceListLoaded = false; 

        if (!synth) {
            startBtn.textContent = '抱歉，您的瀏覽器不支援語音合成功能。';
            startBtn.disabled = true;
        }

        // 停止朗讀
        function stopReading() {
            synth.cancel();
            startBtn.disabled = false;
            stopBtn.disabled = true;
            buttonText.textContent = '開始朗讀 (Start Reading)';
        }

        // 語音選擇函式：只根據語言代碼進行匹配
        function getTargetVoice(selectedLang) {
            const allVoices = synth.getVoices();
            if (allVoices.length === 0) return null;

            // 只使用瀏覽器/系統提供的第一個語言匹配項
            return allVoices.find(voice => voice.lang.startsWith(selectedLang));
        }

        // 開始朗讀
        function startReading() {
            stopReading(); 

            // 檢查語音列表是否已載入
            if (!voiceListLoaded) {
                 alert('語音列表正在載入中，請稍後再試一次。');
                 return;
            }

            const fullText = articleInput.value.trim();
            if (!fullText) {
                alert('請先在文字框內輸入文章！');
                return;
            }

            const selectedLang = langSelect.value;
            const utterance = new SpeechSynthesisUtterance(fullText);

            // 設定語言代碼
            utterance.lang = selectedLang; 

            // 呼叫語音選擇函式
            const finalVoice = getTargetVoice(selectedLang);
            if (finalVoice) {
                utterance.voice = finalVoice;
            }
            
            utterance.rate = 1.0; 
            utterance.pitch = 1.0;

            // 當朗讀開始/結束時更新按鈕狀態
            utterance.onstart = () => {
                startBtn.disabled = true;
                // --- 修正行：將 stopBtn 啟用 (false) ---
                stopBtn.disabled = false; 
                // ----------------------------------------
                buttonText.textContent = '正在朗讀... (Reading...)';
            };
            
            utterance.onend = () => {
                stopReading();
            };
            
            utterance.onerror = (event) => {
                console.error('SpeechSynthesis Utterance Error:', event.error);
                alert(`朗讀發生錯誤: ${event.error}。`);
                stopReading();
            };

            // 開始朗讀
            synth.speak(utterance);
        }

        // 載入語音列表
        function populateVoiceList() {
            if (typeof synth.getVoices === 'undefined') {
                return;
            }
            voiceListLoaded = true; 
        }

        if (synth.onvoiceschanged !== undefined) {
            synth.onvoiceschanged = populateVoiceList;
        }
        populateVoiceList();

        // 綁定事件監聽器
        startBtn.addEventListener('click', startReading);
        stopBtn.addEventListener('click', stopReading);
        
    </script>
</body>
</html>
